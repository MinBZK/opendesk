apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: memcached
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: memcached
    app.kubernetes.io/version: 1.6.22
    helm.sh/chart: memcached-6.7.1
  name: memcached
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: memcached
      app.kubernetes.io/name: memcached
  strategy:
    rollingUpdate: {}
    type: RollingUpdate
  template:
    metadata:
      annotations: null
      labels:
        app.kubernetes.io/instance: memcached
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: memcached
        app.kubernetes.io/version: 1.6.22
        helm.sh/chart: memcached-6.7.1
    spec:
      affinity:
        nodeAffinity: null
        podAffinity: null
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchLabels:
                  app.kubernetes.io/instance: memcached
                  app.kubernetes.io/name: memcached
              topologyKey: kubernetes.io/hostname
            weight: 1
      containers:
      - env:
        - name: BITNAMI_DEBUG
          value: 'false'
        - name: MEMCACHED_PORT_NUMBER
          value: '11211'
        image: registry-1.docker.io/bitnami/memcached:1.6.21-debian-11-r107@sha256:247ec29efd6030960047a623aef025021154662edf6b6d6e88c97936f164d99d
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 6
          initialDelaySeconds: 30
          periodSeconds: 10
          successThreshold: 1
          tcpSocket:
            port: memcache
          timeoutSeconds: 5
        name: memcached
        ports:
        - containerPort: 11211
          name: memcache
        readinessProbe:
          failureThreshold: 6
          initialDelaySeconds: 5
          periodSeconds: 5
          successThreshold: 1
          tcpSocket:
            port: memcache
          timeoutSeconds: 3
        resources:
          limits:
            cpu: 99
            memory: 256Mi
          requests:
            cpu: 0.1
            memory: 32Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1001
          runAsNonRoot: true
          runAsUser: 1001
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /tmp
          name: tmp
      securityContext:
        fsGroup: 1001
      serviceAccountName: memcached
      volumes:
      - emptyDir: {}
        name: tmp
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/component: postfix
    app.kubernetes.io/instance: postfix
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: postfix
    helm.sh/chart: postfix-2.3.0
  name: postfix
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: postfix
      app.kubernetes.io/name: postfix
  strategy:
    type: Recreate
  template:
    metadata:
      annotations:
        checksum/configmapnamespacewatcherbin: 01ba4719c80b6fe911b091a7c05124b64eeece964e09c058ef8f9805daca546b
        checksum/configmapoverrides: 7e1257ac47b8fe7c551018f2467f85b520ce7a226f73bcf5eb7764899f29cd5b
      labels:
        app.kubernetes.io/instance: postfix
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: postfix
        helm.sh/chart: postfix-2.3.0
    spec:
      containers:
      - env: null
        image: registry.opencode.de/bmi/opendesk/components/platform-development/images/postfix:2.0.0@sha256:5b2432dc09318db172a593bca860887ee9d713b9987db64f8b265f3e08a1d374
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: 25
          timeoutSeconds: 5
        name: postfix
        ports:
        - containerPort: 25
          name: smtp
          protocol: TCP
        - containerPort: 587
          name: smtps
          protocol: TCP
        readinessProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 15
          successThreshold: 1
          tcpSocket:
            port: 25
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 128Mi
          requests:
            cpu: 0.1
            memory: 16Mi
        securityContext:
          allowPrivilegeEscalation: true
          capabilities: {}
          privileged: true
          readOnlyRootFilesystem: false
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /etc/postfix/master.cf
          name: config-master
          subPath: master.cf
        - mountPath: /etc/postfix/main.cf
          name: config-main
          subPath: main.cf
        - mountPath: /etc/tls
          name: tls
        - mountPath: /var/spool/postfix
          name: spool-postfix
        - mountPath: /overrides
          name: overrides
      imagePullSecrets: null
      securityContext:
        fsGroup: 101
      serviceAccountName: postfix
      volumes:
      - name: tls
        secret:
          secretName: opendesk-certificates-tls
      - name: spool-postfix
        persistentVolumeClaim:
          claimName: postfix
      - configMap:
          items:
          - key: master.cf
            path: master.cf
          name: postfix-config
        name: config-master
      - configMap:
          items:
          - key: main.cf
            path: main.cf
          name: postfix-config
        name: config-main
      - configMap:
          name: postfix-overrides
        name: overrides
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: minio
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: minio
    app.kubernetes.io/version: 2023.12.20
    helm.sh/chart: minio-12.10.11
  name: minio
  namespace: tn-openbsw-opendesk
spec:
  selector:
    matchLabels:
      app.kubernetes.io/instance: minio
      app.kubernetes.io/name: minio
  strategy:
    type: Recreate
  template:
    metadata:
      annotations:
        checksum/credentials-secret: cd000e33ff644dfee5678e534724787e8e83f3c555fad4c1b860d58b39ab2bb4
      labels:
        app.kubernetes.io/instance: minio
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: minio
        app.kubernetes.io/version: 2023.12.20
        helm.sh/chart: minio-12.10.11
    spec:
      affinity:
        nodeAffinity: null
        podAffinity: null
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchLabels:
                  app.kubernetes.io/instance: minio
                  app.kubernetes.io/name: minio
              topologyKey: kubernetes.io/hostname
            weight: 1
      containers:
      - env:
        - name: BITNAMI_DEBUG
          value: 'false'
        - name: MINIO_SCHEME
          value: http
        - name: MINIO_FORCE_NEW_KEYS
          value: 'no'
        - name: MINIO_ROOT_USER
          valueFrom:
            secretKeyRef:
              key: root-user
              name: minio
        - name: MINIO_ROOT_PASSWORD
          valueFrom:
            secretKeyRef:
              key: root-password
              name: minio
        - name: MINIO_DEFAULT_BUCKETS
          value: openproject,openxchange,ums,nextcloud
        - name: MINIO_BROWSER
          value: 'on'
        - name: MINIO_PROMETHEUS_AUTH_TYPE
          value: public
        - name: MINIO_CONSOLE_PORT_NUMBER
          value: '9001'
        envFrom: null
        image: registry-1.docker.io/bitnami/minio:2023@sha256:bced4f2f9fc48b755ebb3e1b35e76195a978d4331bf2d0c6699dab412d3c0be7
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 5
          httpGet:
            path: /minio/health/live
            port: minio-api
            scheme: HTTP
          initialDelaySeconds: 5
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 10
        name: minio
        ports:
        - containerPort: 9000
          name: minio-api
          protocol: TCP
        - containerPort: 9001
          name: minio-console
          protocol: TCP
        readinessProbe:
          failureThreshold: 5
          initialDelaySeconds: 5
          periodSeconds: 10
          successThreshold: 1
          tcpSocket:
            port: minio-api
          timeoutSeconds: 10
        resources:
          limits:
            cpu: 99
            memory: 2Gi
          requests:
            cpu: 0.25
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: false
          runAsGroup: 0
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        startupProbe:
          failureThreshold: 60
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          tcpSocket:
            port: minio-console
          timeoutSeconds: 10
        volumeMounts:
        - mountPath: /bitnami/minio/data
          name: data
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: minio
      volumes:
      - name: data
        persistentVolumeClaim:
          claimName: minio
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: ums
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: ums-guardian-authorization-api
    app.kubernetes.io/version: 2.0.0
    helm.sh/chart: nubusGuardian-0.14.0
  name: ums-guardian-authorization-api
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: ums
      app.kubernetes.io/name: ums-guardian-authorization-api
  template:
    metadata:
      annotations:
        checksum/config: b0ec52b725d7ebf01db435089c97fe12e407034959e784698b5a87297537ce42
        intents.otterize.com/service-name: ums-guardian-authorization-api
      labels:
        app.kubernetes.io/instance: ums
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: ums-guardian-authorization-api
        app.kubernetes.io/version: 2.0.0
        helm.sh/chart: nubusGuardian-0.14.0
    spec:
      containers:
      - envFrom:
        - configMapRef:
            name: ums-guardian-authorization-api
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/guardian-authorization-api-authorization-api:2.0.0@sha256:5f194f9385aea5a279e25a57352f7b88a6cc4fa90b3bf04c2c97b9ff2bad70a5
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /guardian/authorization/openapi.json
            port: http
          initialDelaySeconds: 120
          periodSeconds: 30
          successThreshold: 1
          timeoutSeconds: 3
        name: authorization-api
        ports:
        - containerPort: 8000
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 30
          httpGet:
            path: /guardian/authorization/openapi.json
            port: http
          initialDelaySeconds: 30
          periodSeconds: 15
          successThreshold: 1
          timeoutSeconds: 3
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /var/secrets
          name: secrets
        - mountPath: /tmp
          name: tmp
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: Always
      volumes:
      - emptyDir: {}
        name: tmp
      - name: secrets
        secret:
          secretName: ums-guardian-udm-secret
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: ums
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: ums-guardian-management-api
    app.kubernetes.io/version: 2.0.0
    helm.sh/chart: nubusGuardian-0.14.0
  name: ums-guardian-management-api
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: ums
      app.kubernetes.io/name: ums-guardian-management-api
  template:
    metadata:
      annotations:
        checksum/config: da3bb9875712b10e66e6d1285918a241031555476d408dc0edf3a0a14a323290
        intents.otterize.com/service-name: ums-guardian-management-api
      labels:
        app.kubernetes.io/instance: ums
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: ums-guardian-management-api
        app.kubernetes.io/version: 2.0.0
        helm.sh/chart: nubusGuardian-0.14.0
    spec:
      containers:
      - env:
        - name: SQL_PERSISTENCE_ADAPTER__PASSWORD
          valueFrom:
            secretKeyRef:
              key: guardianDatabasePassword
              name: ums-guardian-postgresql-opendesk-credentials
        envFrom:
        - configMapRef:
            name: ums-guardian-management-api
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/guardian-management-api-management-api:2.0.0@sha256:61a1ab84efebe2a87d358e8624f8b39073a6071683e7cd77b740a97d464753a2
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /guardian/management/openapi.json
            port: http
          initialDelaySeconds: 120
          periodSeconds: 30
          successThreshold: 1
          timeoutSeconds: 3
        name: management-api
        ports:
        - containerPort: 8000
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 30
          httpGet:
            path: /guardian/management/openapi.json
            port: http
          initialDelaySeconds: 30
          periodSeconds: 15
          successThreshold: 1
          timeoutSeconds: 3
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /var/secrets
          name: secrets
        - mountPath: /guardian_service_dir/bundle_server
          name: bundles
        - mountPath: /tmp
          name: tmp
      initContainers:
      - command:
        - alembic
        - upgrade
        - head
        env:
        - name: SQL_PERSISTENCE_ADAPTER__PASSWORD
          valueFrom:
            secretKeyRef:
              key: guardianDatabasePassword
              name: ums-guardian-postgresql-opendesk-credentials
        envFrom:
        - configMapRef:
            name: ums-guardian-management-api
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/guardian-management-api-management-api:2.0.0@sha256:61a1ab84efebe2a87d358e8624f8b39073a6071683e7cd77b740a97d464753a2
        imagePullPolicy: IfNotPresent
        name: database-migrations
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: Always
      volumes:
      - emptyDir: {}
        name: bundles
      - emptyDir: {}
        name: tmp
      - name: secrets
        secret:
          secretName: ums-guardian-keycloak-client-secret
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: ums
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: ums-guardian-management-ui
    app.kubernetes.io/version: 2.0.0
    helm.sh/chart: nubusGuardian-0.14.0
  name: ums-guardian-management-ui
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: ums
      app.kubernetes.io/name: ums-guardian-management-ui
  template:
    metadata:
      annotations:
        checksum/config: 8689bb3db711f9e99a5f77b9eafd0d9aac4642ab71e0639820ab97f284af621b
        intents.otterize.com/service-name: ums-guardian-management-ui
      labels:
        app.kubernetes.io/instance: ums
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: ums-guardian-management-ui
        app.kubernetes.io/version: 2.0.0
        helm.sh/chart: nubusGuardian-0.14.0
    spec:
      containers:
      - envFrom:
        - configMapRef:
            name: ums-guardian-management-ui
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/guardian-management-ui-management-ui:2.0.0@sha256:57e2503a4772f0ff656e792a98fadef4d41c248218e6c368f76ce82a892478cf
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /
            port: http
          initialDelaySeconds: 120
          periodSeconds: 30
          successThreshold: 1
          timeoutSeconds: 3
        name: management-ui
        ports:
        - containerPort: 8383
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 30
          httpGet:
            path: /
            port: http
          initialDelaySeconds: 30
          periodSeconds: 15
          successThreshold: 1
          timeoutSeconds: 3
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          enabled: true
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /app
          name: app-config
        - mountPath: /etc/nginx/sites-enabled/default
          name: nginx-conf
          subPath: nginx.conf
        - mountPath: /entrypoint.d
          name: entrypoint
        - mountPath: /var/lib/nginx
          name: var-lib
        - mountPath: /var/run
          name: var-run
      initContainers:
      - command:
        - sh
        - -c
        - /entrypoint.sh; cp -a /app/* /target/app/
        envFrom:
        - configMapRef:
            name: ums-guardian-management-ui
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/guardian-management-ui-management-ui:2.0.0@sha256:57e2503a4772f0ff656e792a98fadef4d41c248218e6c368f76ce82a892478cf
        imagePullPolicy: IfNotPresent
        name: app-configuration
        volumeMounts:
        - mountPath: /entrypoint.d/10-generate_config.sh
          name: init-entrypoints-config
        - mountPath: /target/app
          name: app-config
      volumes:
      - emptyDir: {}
        name: app-config
      - emptyDir: {}
        name: entrypoint
      - emptyDir: {}
        name: var-lib
      - emptyDir: {}
        name: var-run
      - configMap:
          defaultMode: 365
          name: ums-guardian-init-config-management-ui
        name: init-entrypoints-config
      - configMap:
          name: ums-guardian-nginx-conf
        name: nginx-conf
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: ums
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: ums-guardian-open-policy-agent
    app.kubernetes.io/version: 2.0.0
    helm.sh/chart: nubusGuardian-0.14.0
  name: ums-guardian-open-policy-agent
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: ums
      app.kubernetes.io/name: ums-guardian-open-policy-agent
  template:
    metadata:
      annotations:
        checksum/config: 655fe4dd682ce9ce5707e284f5ff2189c4ad7ba3e57b8d65a2d05e2e88d5a5db
        intents.otterize.com/service-name: ums-ums-open-policy-agent
      labels:
        app.kubernetes.io/instance: ums
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: ums-guardian-open-policy-agent
        app.kubernetes.io/version: 2.0.0
        helm.sh/chart: nubusGuardian-0.14.0
    spec:
      containers:
      - envFrom:
        - configMapRef:
            name: ums-guardian-open-policy-agent
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/guardian-authorization-api-opa:2.0.0@sha256:56a92a08da5addb951a2b2df09974889295ddde8526e93ad40dd973de1052ad4
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /
            port: http
          initialDelaySeconds: 120
          periodSeconds: 30
          successThreshold: 1
          timeoutSeconds: 3
        name: open-policy-agent
        ports:
        - containerPort: 8181
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 30
          httpGet:
            path: /
            port: http
          initialDelaySeconds: 30
          periodSeconds: 15
          successThreshold: 1
          timeoutSeconds: 3
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seccompProfile:
            type: RuntimeDefault
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: Always
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: ums
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: ums-keycloak-extensions-handler
    app.kubernetes.io/version: 21.0.1
    helm.sh/chart: nubusKeycloakExtensions-0.11.0
  name: ums-keycloak-extensions-handler
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: ums
      app.kubernetes.io/name: ums-keycloak-extensions-handler
  template:
    metadata:
      annotations:
        checksum/config: 5fb16770ece8d751f8c4d169b9df8ef51f5ffde4935f813bb5e8f04de625a38a
        intents.otterize.com/service-name: ums-keycloak-extensions-handler
      labels:
        app.kubernetes.io/instance: ums
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: ums-keycloak-extensions-handler
        app.kubernetes.io/version: 21.0.1
        helm.sh/chart: nubusKeycloakExtensions-0.11.0
    spec:
      containers:
      - env:
        - name: KC_PASS
          valueFrom:
            secretKeyRef:
              key: admin_password
              name: ums-opendesk-keycloak-credentials
        - name: POSTGRES_PASSWORD
          valueFrom:
            secretKeyRef:
              key: umcKeycloakExtensionsDatabasePassword
              name: ums-keycloak-extensions-postgresql-opendesk-credentials
        - name: SMTP_PASSWORD
          valueFrom:
            secretKeyRef:
              key: umcKeycloakExtensionsSmtpPassword
              name: ums-keycloak-extensions-smtp-opendesk-credentials
        envFrom:
        - configMapRef:
            name: ums-keycloak-extensions-handler
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/keycloak-handler:0.11.0@sha256:aaba6527f37a7302cf54b0a689a1c11cb439bdc471e01d101726a05902714b9c
        imagePullPolicy: IfNotPresent
        name: keycloak-bfp-handler
        ports: null
        resources:
          limits:
            cpu: 99
            memory: 256Mi
          requests:
            cpu: 0.1
            memory: 48Mi
        securityContext:
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
      serviceAccountName: ums-keycloak-extensions-handler
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: ums
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: ums-keycloak-extensions-proxy
    app.kubernetes.io/version: 21.0.1
    helm.sh/chart: nubusKeycloakExtensions-0.11.0
  name: ums-keycloak-extensions-proxy
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: ums
      app.kubernetes.io/name: ums-keycloak-extensions-proxy
  template:
    metadata:
      annotations:
        checksum/config: 2d3d5a51fdac99f1ee102f64e107c8f43464910c8a3dda8d05b61020dd6094f8
        intents.otterize.com/service-name: ums-keycloak-extensions-proxy
      labels:
        app.kubernetes.io/instance: ums
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: ums-keycloak-extensions-proxy
        app.kubernetes.io/version: 21.0.1
        helm.sh/chart: nubusKeycloakExtensions-0.11.0
    spec:
      containers:
      - env:
        - name: KC_PASS
          valueFrom:
            secretKeyRef:
              key: admin_password
              name: ums-opendesk-keycloak-credentials
        - name: POSTGRES_PASSWORD
          valueFrom:
            secretKeyRef:
              key: umcKeycloakExtensionsDatabasePassword
              name: ums-keycloak-extensions-postgresql-opendesk-credentials
        - name: CAPTCHA_SITE_KEY
          value: some_site_key
        - name: CAPTCHA_SECRET_KEY
          value: some_secret_key
        envFrom:
        - configMapRef:
            name: ums-keycloak-extensions-proxy
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/keycloak-proxy:0.11.0@sha256:9b2079ed4078daee00d95ac2de4d72497131e699b967943db5be1c655048edb0
        imagePullPolicy: IfNotPresent
        name: keycloak-bfp-proxy
        ports:
        - containerPort: 8181
          name: http
          protocol: TCP
        resources:
          limits:
            cpu: 99
            memory: 256Mi
          requests:
            cpu: 0.1
            memory: 48Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
      serviceAccountName: ums-keycloak-extensions-proxy
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    intents.otterize.com/service-name: ums-ldap-server
  labels:
    app.kubernetes.io/instance: ums
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: ldap-server
    helm.sh/chart: nubusLdapServer-0.25.2
    ldap-server-type: proxy
  name: ums-ldap-server-proxy
  namespace: tn-openbsw-opendesk
spec:
  replicas: 0
  selector:
    matchLabels:
      app.kubernetes.io/instance: ums
      app.kubernetes.io/name: ldap-server
      ldap-server-type: proxy
  strategy:
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/configmap: d7d4bafa2b955d657e9cb9a161bd7de8bef666818d29e139e2add788ba77355b
        checksum/configmap-proxy: 74556f6b8d345b0270648440b719332b388f098b0a690c2c98a75b1f75697c90
      labels:
        app.kubernetes.io/instance: ums
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: ldap-server
        helm.sh/chart: nubusLdapServer-0.25.2
        ldap-server-type: proxy
    spec:
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: ldap-server-type
                  operator: In
                  values:
                  - proxy
              topologyKey: kubernetes.io/hostname
            weight: 100
      containers:
      - env:
        - name: LDAP_CN_ADMIN_PW
          valueFrom:
            secretKeyRef:
              key: adminPassword
              name: ums-ldap-server-credentials
        envFrom:
        - configMapRef:
            name: ums-ldap-server
        - configMapRef:
            name: ums-ldap-server-proxy
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/ldap-server:0.25.2@sha256:2b9d53f93a93d0f3a659c81c0e44596da8941bd83c8e1f7301a24e46ca06dba2
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: 389
          timeoutSeconds: 5
        name: openldap
        ports:
        - containerPort: 389
          name: ldap
          protocol: TCP
        - containerPort: 636
          name: ldaps
          protocol: TCP
        readinessProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: 389
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 288
            memory: 1Gi
          requests:
            cpu: 10m
            memory: 16Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 102
          runAsNonRoot: true
          runAsUser: 101
          seccompProfile:
            type: RuntimeDefault
        startupProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: 389
          timeoutSeconds: 5
        volumeMounts:
        - mountPath: /usr/share/univention-ldap
          name: usr-share-univention-ldap-volume
        - mountPath: /usr/share/saml
          name: usr-share-saml-volume
        - mountPath: /etc/ldap
          name: etc-ldap-volume
        - mountPath: /etc/univention
          name: etc-univention-volume
        - mountPath: /config/templates
          name: proxy-config-templates-volume
        - mountPath: /entrypoint.d/90-generate-slapd-conf.sh
          name: proxy-scripts-volume
          subPath: generate-slapd.conf.sh
        - mountPath: /var/lib/univention-ldap-local/local-schema
          name: plugin-targets
          subPath: ldap-schema
        - mountPath: /etc/univention/templates/files/etc/ldap/slapd.conf.d
          name: plugin-targets
          subPath: ldap-acls
        - mountPath: /var/run/slapd
          name: var-run-volume
        - mountPath: /etc/univention/base.conf
          name: config-map-ucr
          subPath: base.conf
        - mountPath: /etc/univention/base-defaults.conf
          name: config-map-ucr
          subPath: base-defaults.conf
        - mountPath: /var/lib/univention-ldap
          name: data-volume
        - mountPath: /entrypoint.d/30-purge.sh
          name: migration-scripts
          subPath: 30-purge.sh
        - mountPath: /entrypoint.d/95-slapadd-24-ldiff.sh
          name: migration-scripts
          subPath: 95-slapadd-24-ldif.sh
      initContainers:
      - command:
        - sh
        - -c
        - cp -a /usr/share/univention-ldap/* /target/usr/share/univention-ldap/; cp
          -a /etc/ldap/* /target/etc/ldap/; cp -a /etc/univention/* /target/etc/univention/
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/ldap-server:0.25.2@sha256:2b9d53f93a93d0f3a659c81c0e44596da8941bd83c8e1f7301a24e46ca06dba2
        imagePullPolicy: IfNotPresent
        name: univention-compatibility
        resources:
          limits:
            cpu: 288
            memory: 1Gi
          requests:
            cpu: 10m
            memory: 16Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 102
          runAsNonRoot: true
          runAsUser: 101
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /target/usr/share/univention-ldap
          name: usr-share-univention-ldap-volume
        - mountPath: /target/etc/ldap
          name: etc-ldap-volume
        - mountPath: /target/etc/univention
          name: etc-univention-volume
      - command:
        - sh
        - -c
        - 'cp -av /var/lib/univention-ldap-local/local-schema /target/ldap-schema

          cp -av /etc/univention/templates/files/etc/ldap/slapd.conf.d /target/ldap-acls

          '
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/ldap-server:0.25.2@sha256:2b9d53f93a93d0f3a659c81c0e44596da8941bd83c8e1f7301a24e46ca06dba2
        imagePullPolicy: IfNotPresent
        name: load-internal-plugins
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 102
          runAsNonRoot: true
          runAsUser: 101
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /target
          name: plugin-targets
      - image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/portal-extension:0.38.0@sha256:aa6ec6b99810e05655d98fa1192bc2eabb855335f7a04aa4cd96ed5b5645d736
        imagePullPolicy: IfNotPresent
        name: load-portal-extension
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 102
          runAsNonRoot: true
          runAsUser: 101
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /target
          name: plugin-targets
      - image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/ox-extension:0.11.0@sha256:2cb5a9683b6ff81b995a5c71da52c2ff8177b662bb0be8f11e9cd0c6b48d8a11
        imagePullPolicy: IfNotPresent
        name: load-ox-extension
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 102
          runAsNonRoot: true
          runAsUser: 101
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /target
          name: plugin-targets
      - image: registry.opencode.de/bmi/opendesk/components/platform-development/images/opendesk-nubus:1.7.5@sha256:cc38d339abea18dc3644b7764d7be13798956161d1c87e34b26b5d8b7a11edc6
        imagePullPolicy: IfNotPresent
        name: load-opendesk-extension
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 102
          runAsNonRoot: true
          runAsUser: 101
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /target
          name: plugin-targets
      - command:
        - bash
        - -c
        - /scripts-proxy/wait-for-secondary.sh
        env:
        - name: LDAP_CN_ADMIN_PW
          valueFrom:
            secretKeyRef:
              key: adminPassword
              name: ums-ldap-server-credentials
        envFrom:
        - configMapRef:
            name: ums-ldap-server
        - configMapRef:
            name: ums-ldap-server-proxy
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/ldap-server:0.25.2@sha256:2b9d53f93a93d0f3a659c81c0e44596da8941bd83c8e1f7301a24e46ca06dba2
        imagePullPolicy: IfNotPresent
        name: wait-for-secondary
        resources:
          limits:
            cpu: 288
            memory: 1Gi
          requests:
            cpu: 10m
            memory: 16Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 102
          runAsNonRoot: true
          runAsUser: 101
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /scripts-proxy
          name: proxy-scripts-volume
      - command:
        - /bin/bash
        - /scripts/wait-for-saml-metadata.sh
        envFrom:
        - configMapRef:
            name: ums-ldap-server
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/wait-for-dependency:0.26.0@sha256:a31fde86bf21c597a31356fe492ab7e7a03a89282ca215eb7100763d6eb96b6b
        imagePullPolicy: IfNotPresent
        name: wait-for-saml-metadata
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 102
          runAsNonRoot: true
          runAsUser: 101
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /scripts
          name: scripts-volume
        - mountPath: /etc/univention/base.conf
          name: config-map-ucr
          subPath: base.conf
        - mountPath: /etc/univention/base-defaults.conf
          name: config-map-ucr
          subPath: base-defaults.conf
      securityContext:
        fsGroup: 102
        fsGroupChangePolicy: Always
        sysctls:
        - name: net.ipv4.ip_unprivileged_port_start
          value: '1'
      serviceAccountName: ums-ldap-server
      terminationGracePeriodSeconds: 5
      volumes:
      - emptyDir: {}
        name: data-volume
      - emptyDir: {}
        name: var-run-volume
      - emptyDir: {}
        name: usr-share-univention-ldap-volume
      - emptyDir: {}
        name: usr-share-saml-volume
      - emptyDir: {}
        name: etc-ldap-volume
      - emptyDir: {}
        name: etc-univention-volume
      - configMap:
          defaultMode: 365
          name: ums-ldap-server-proxy-scripts
        name: proxy-scripts-volume
      - configMap:
          name: ums-ldap-server-proxy-config-templates
        name: proxy-config-templates-volume
      - configMap:
          defaultMode: 365
          name: ums-ldap-server-scripts
        name: scripts-volume
      - emptyDir: {}
        name: plugin-targets
      - configMap:
          name: ums-stack-data-ums-ucr
        name: config-map-ucr
      - name: migration-scripts
        secret:
          defaultMode: 365
          secretName: ums-ldap-server-migration
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    intents.otterize.com/service-name: ums-notifications-api
  labels:
    app.kubernetes.io/instance: ums
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: notifications-api
    app.kubernetes.io/version: 1.16.0
    helm.sh/chart: nubusNotificationsApi-0.42.2
  name: ums-notifications-api
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: ums
      app.kubernetes.io/name: notifications-api
  template:
    metadata:
      annotations:
        checksum/configmap: 7ee9a265a1c5a872f84a9b8c4f71c94be7376aceff9254f7e84b7518766a0140
      labels:
        app.kubernetes.io/instance: ums
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: notifications-api
        app.kubernetes.io/version: 1.16.0
        helm.sh/chart: nubusNotificationsApi-0.42.2
    spec:
      containers:
      - env:
        - name: DB_USERNAME
          value: notificationsapi_user
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              key: password
              name: ums-notifications-api-postgresql-opendesk-credentials
        - name: DATABASE
          value: notificationsapi
        - name: DATABASE_URL
          value: postgresql://$(DB_USERNAME):$(DB_PASSWORD)@postgresql:5432/$(DATABASE)
        envFrom:
        - configMapRef:
            name: ums-notifications-api
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/notifications-api:0.42.2@sha256:ff744b2d5388bfc413a4d25108f37ba086d2a08cb14ceb02d17e93de003a1078
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: 8080
          timeoutSeconds: 5
        name: notification-api
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: 8080
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        startupProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: 8080
          timeoutSeconds: 5
        volumeMounts: null
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: Always
        sysctls: []
      serviceAccountName: ums-notifications-api
      terminationGracePeriodSeconds: 5
      volumes: null
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    intents.otterize.com/service-name: ums-portal-frontend
  labels:
    app.kubernetes.io/instance: ums
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: portal-frontend
    app.kubernetes.io/version: 1.16.0
    helm.sh/chart: nubusPortalFrontend-0.42.2
  name: ums-portal-frontend
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: ums
      app.kubernetes.io/name: portal-frontend
  template:
    metadata:
      annotations:
        checksum/configmap: 565734614dae43cfba57ae70455622b7cf1de28c87161911d8cbfe1d114d59e5
      labels:
        app.kubernetes.io/instance: ums
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: portal-frontend
        app.kubernetes.io/version: 1.16.0
        helm.sh/chart: nubusPortalFrontend-0.42.2
    spec:
      containers:
      - envFrom:
        - configMapRef:
            name: ums-portal-frontend
        image: registry.opencode.de/bmi/opendesk/components/platform-development/images/opendesk-nubus-portal-update:1.8.1@sha256:dd2c8e16b57d5b2a97f465b15e108231782e3ee2df1cc07cee0388459bf40e1c
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: 80
          timeoutSeconds: 5
        name: portal-frontend
        ports:
        - containerPort: 80
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: 80
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        startupProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: 80
          timeoutSeconds: 5
        volumeMounts:
        - mountPath: /var/run
          name: var-run-volume
        - mountPath: /var/lib/nginx
          name: var-lib-nginx-volume
        - mountPath: /etc/nginx/nginx.conf
          name: ums-portal-frontend-nginx
          subPath: nginx.conf
        - mountPath: /var/www/html/favicon.ico
          name: ums-portal-frontend-branding
          subPath: favicon.ico
        - mountPath: /var/www/html/css/custom.css
          name: ums-portal-frontend-branding
          subPath: custom.css
        - mountPath: /var/www/html/icons/logo.svg
          name: ums-portal-frontend-branding
          subPath: logo.svg
        - mountPath: /var/www/html/custom/portal_background_image.svg
          name: ums-portal-frontend-branding
          subPath: portal_background_image.svg
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: Always
        sysctls:
        - name: net.ipv4.ip_unprivileged_port_start
          value: '1'
      serviceAccountName: ums-portal-frontend
      terminationGracePeriodSeconds: 5
      volumes:
      - emptyDir: {}
        name: var-run-volume
      - emptyDir: {}
        name: var-lib-nginx-volume
      - configMap:
          defaultMode: 420
          name: ums-portal-frontend-nginx
        name: ums-portal-frontend-nginx
      - configMap:
          name: ums-portal-frontend-branding
        name: ums-portal-frontend-branding
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    intents.otterize.com/service-name: ums-portal-server
  labels:
    app.kubernetes.io/instance: ums
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: portal-server
    app.kubernetes.io/version: 1.16.0
    helm.sh/chart: nubusPortalServer-0.42.2
  name: ums-portal-server
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: ums
      app.kubernetes.io/name: portal-server
  template:
    metadata:
      annotations:
        checksum/configmap: 62cc3ffcc9728b13197bd09deebc1c0247c898705aa01cbbc2954b15874e67be
      labels:
        app.kubernetes.io/instance: ums
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: portal-server
        app.kubernetes.io/version: 1.16.0
        helm.sh/chart: nubusPortalServer-0.42.2
    spec:
      containers:
      - env:
        - name: OBJECT_STORAGE_ACCESS_KEY_ID
          valueFrom:
            secretKeyRef:
              key: access-key-id
              name: ums-portal-server-minio-opendesk-credentials
        - name: OBJECT_STORAGE_SECRET_ACCESS_KEY
          valueFrom:
            secretKeyRef:
              key: secret-key-id
              name: ums-portal-server-minio-opendesk-credentials
        envFrom:
        - configMapRef:
            name: ums-portal-server
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/portal-server:0.42.2@sha256:00b45c354c421ad6bc0ee046444cc0a2caf633787c770cad60e7c06c4307a248
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: 80
          timeoutSeconds: 5
        name: portal-server
        ports:
        - containerPort: 80
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: 80
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        startupProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: 80
          timeoutSeconds: 5
        volumeMounts:
        - mountPath: /usr/lib/univention-portal/config
          name: usr-lib-univention-portal-config-volume
        - mountPath: /usr/share/univention-portal
          name: usr-share-univention-portal-volume
        - mountPath: /var/secrets/authenticator.secret
          name: authenticator-secret
          subPath: authenticator.secret
        - mountPath: /tmp
          name: tmp-volume
      initContainers:
      - command:
        - /bin/bash
        - -c
        - 'set -euxo pipefail

          cp -a /usr/share/univention-portal/* /target/usr/share/univention-portal/

          '
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/portal-server:0.42.2@sha256:00b45c354c421ad6bc0ee046444cc0a2caf633787c770cad60e7c06c4307a248
        imagePullPolicy: IfNotPresent
        name: copy-files
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /target/usr/share/univention-portal
          name: usr-share-univention-portal-volume
        - mountPath: /tmp
          name: tmp-volume
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: Always
        sysctls:
        - name: net.ipv4.ip_unprivileged_port_start
          value: '1'
      serviceAccountName: ums-portal-server
      terminationGracePeriodSeconds: 5
      volumes:
      - emptyDir: {}
        name: usr-lib-univention-portal-config-volume
      - emptyDir: {}
        name: usr-share-univention-portal-volume
      - name: authenticator-secret
        secret:
          secretName: ums-opendesk-portal-server-central-navigation
      - emptyDir: {}
        name: tmp-volume
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    intents.otterize.com/service-name: ums-provisioning-dispatcher
  labels:
    app.kubernetes.io/instance: ums
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: ums-provisioning-dispatcher
    helm.sh/chart: nubusProvisioning-0.44.0
  name: ums-provisioning-dispatcher
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: ums
      app.kubernetes.io/name: ums-provisioning-dispatcher
  strategy:
    type: Recreate
  template:
    metadata:
      annotations:
        checksum/configmap: 917567cd1bf78b07341165ced3d60f9dafa444131455805ae1605e064a9a10c7
      labels:
        app.kubernetes.io/instance: ums
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: ums-provisioning-dispatcher
        helm.sh/chart: nubusProvisioning-0.44.0
    spec:
      containers:
      - envFrom:
        - configMapRef:
            name: ums-provisioning-common
        - configMapRef:
            name: ums-provisioning-dispatcher
        - secretRef:
            name: ums-provisioning-dispatcher-credentials
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/provisioning-dispatcher:0.44.0@sha256:b7b9ee59c008bd8850bcfb6cb009ae47e6be43ed117116928374c721711b09ca
        imagePullPolicy: IfNotPresent
        livenessProbe:
          exec:
            command:
            - sh
            - -c
            - 'exit 0

              '
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          timeoutSeconds: 5
        name: dispatcher
        readinessProbe:
          exec:
            command:
            - sh
            - -c
            - 'exit 0

              '
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 288
            memory: 1Gi
          requests:
            cpu: 10m
            memory: 16Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        startupProbe:
          exec:
            command:
            - sh
            - -c
            - 'exit 0

              '
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          timeoutSeconds: 5
      initContainers:
      - command:
        - poetry
        - run
        - python
        - /scripts/wait-for-nats.py
        envFrom:
        - configMapRef:
            name: ums-provisioning-common
        - configMapRef:
            name: ums-provisioning-api
        - secretRef:
            name: ums-provisioning-api-credentials
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/provisioning-events-and-consumer-api:0.44.0@sha256:b87218dcd2db7539b786ff479cde9620939274d4365721531dc6075b6fcc19ea
        imagePullPolicy: IfNotPresent
        name: wait-for-nats
        resources:
          limits:
            cpu: 288
            memory: 1Gi
          requests:
            cpu: 10m
            memory: 16Mi
        volumeMounts:
        - mountPath: /scripts
          name: wait-for-nats
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: Always
        sysctls:
        - name: net.ipv4.ip_unprivileged_port_start
          value: '1'
      serviceAccountName: ums-provisioning
      terminationGracePeriodSeconds: 5
      volumes:
      - configMap:
          name: ums-provisioning-api
        name: wait-for-nats
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    intents.otterize.com/service-name: ums-provisioning-api
  labels:
    app.kubernetes.io/instance: ums
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: ums-provisioning-api
    helm.sh/chart: nubusProvisioning-0.44.0
  name: ums-provisioning-api
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: ums
      app.kubernetes.io/name: ums-provisioning-api
  strategy:
    type: Recreate
  template:
    metadata:
      annotations:
        checksum/configmap: 917567cd1bf78b07341165ced3d60f9dafa444131455805ae1605e064a9a10c7
      labels:
        app.kubernetes.io/instance: ums
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: ums-provisioning-api
        helm.sh/chart: nubusProvisioning-0.44.0
    spec:
      containers:
      - envFrom:
        - configMapRef:
            name: ums-provisioning-common
        - configMapRef:
            name: ums-provisioning-api
        - secretRef:
            name: ums-provisioning-api-credentials
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/provisioning-events-and-consumer-api:0.44.0@sha256:b87218dcd2db7539b786ff479cde9620939274d4365721531dc6075b6fcc19ea
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: 7777
          timeoutSeconds: 5
        name: api
        ports:
        - containerPort: 7777
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: 7777
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 288
            memory: 1Gi
          requests:
            cpu: 10m
            memory: 16Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        startupProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: 7777
      initContainers:
      - command:
        - poetry
        - run
        - python
        - /scripts/wait-for-nats.py
        envFrom:
        - configMapRef:
            name: ums-provisioning-common
        - configMapRef:
            name: ums-provisioning-api
        - secretRef:
            name: ums-provisioning-api-credentials
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/provisioning-events-and-consumer-api:0.44.0@sha256:b87218dcd2db7539b786ff479cde9620939274d4365721531dc6075b6fcc19ea
        imagePullPolicy: IfNotPresent
        name: wait-for-nats
        resources:
          limits:
            cpu: 288
            memory: 1Gi
          requests:
            cpu: 10m
            memory: 16Mi
        volumeMounts:
        - mountPath: /scripts
          name: wait-for-nats
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: Always
        sysctls:
        - name: net.ipv4.ip_unprivileged_port_start
          value: '1'
      serviceAccountName: ums-provisioning
      terminationGracePeriodSeconds: 5
      volumes:
      - configMap:
          name: ums-provisioning-api
        name: wait-for-nats
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    intents.otterize.com/service-name: ums-provisioning-prefill
  labels:
    app.kubernetes.io/instance: ums
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: ums-provisioning-prefill
    helm.sh/chart: nubusProvisioning-0.44.0
  name: ums-provisioning-prefill
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: ums
      app.kubernetes.io/name: ums-provisioning-prefill
  strategy:
    type: Recreate
  template:
    metadata:
      annotations:
        checksum/configmap: 917567cd1bf78b07341165ced3d60f9dafa444131455805ae1605e064a9a10c7
      labels:
        app.kubernetes.io/instance: ums
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: ums-provisioning-prefill
        helm.sh/chart: nubusProvisioning-0.44.0
    spec:
      containers:
      - envFrom:
        - configMapRef:
            name: ums-provisioning-common
        - configMapRef:
            name: ums-provisioning-prefill
        - secretRef:
            name: ums-provisioning-prefill-credentials
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/provisioning-prefill:0.44.0@sha256:86201a277164ceb9a8df3fd4c7fc28b0185cadf7962a937d88d9feb576e77da2
        imagePullPolicy: IfNotPresent
        livenessProbe:
          exec:
            command:
            - sh
            - -c
            - 'exit 0

              '
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          timeoutSeconds: 5
        name: prefill
        readinessProbe:
          exec:
            command:
            - sh
            - -c
            - 'exit 0

              '
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 288
            memory: 1Gi
          requests:
            cpu: 10m
            memory: 16Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        startupProbe:
          exec:
            command:
            - sh
            - -c
            - 'exit 0

              '
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          timeoutSeconds: 5
      initContainers:
      - command:
        - /usr/bin/python3
        - /scripts/wait-for-udm.py
        envFrom:
        - configMapRef:
            name: ums-provisioning-prefill
        - secretRef:
            name: ums-provisioning-prefill-credentials
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/provisioning-prefill:0.44.0@sha256:86201a277164ceb9a8df3fd4c7fc28b0185cadf7962a937d88d9feb576e77da2
        imagePullPolicy: IfNotPresent
        name: wait-for-udm
        resources:
          limits:
            cpu: 288
            memory: 1Gi
          requests:
            cpu: 10m
            memory: 16Mi
        volumeMounts:
        - mountPath: /scripts
          name: wait-for-udm
      - command:
        - bash
        - -c
        - set -euo pipefail; until curl -s http://${PROVISIONING_API_HOST}:${PROVISIONING_API_PORT}/v1/subscriptions
          > /dev/null || [ $? -ne 0 ]; do echo Waiting for api; sleep 2; done;
        envFrom:
        - configMapRef:
            name: ums-provisioning-common
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/wait-for-dependency:0.26.0@sha256:a31fde86bf21c597a31356fe492ab7e7a03a89282ca215eb7100763d6eb96b6b
        imagePullPolicy: IfNotPresent
        name: wait-for-api-to-start
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 64Mi
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: Always
        sysctls:
        - name: net.ipv4.ip_unprivileged_port_start
          value: '1'
      serviceAccountName: ums-provisioning
      terminationGracePeriodSeconds: 5
      volumes:
      - configMap:
          name: ums-provisioning-prefill
        name: wait-for-udm
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    intents.otterize.com/service-name: ums-provisioning-udm-transformer
  labels:
    app.kubernetes.io/instance: ums
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: ums-provisioning-udm-transformer
    helm.sh/chart: nubusProvisioning-0.44.0
  name: ums-provisioning-udm-transformer
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: ums
      app.kubernetes.io/name: ums-provisioning-udm-transformer
  strategy:
    type: Recreate
  template:
    metadata:
      annotations:
        checksum/configmap: 917567cd1bf78b07341165ced3d60f9dafa444131455805ae1605e064a9a10c7
      labels:
        app.kubernetes.io/instance: ums
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: ums-provisioning-udm-transformer
        helm.sh/chart: nubusProvisioning-0.44.0
    spec:
      containers:
      - envFrom:
        - configMapRef:
            name: ums-provisioning-common
        - configMapRef:
            name: ums-provisioning-udm-transformer
        - secretRef:
            name: ums-provisioning-udm-transformer-api-credentials
        - secretRef:
            name: ums-provisioning-udm-transformer-nats-credentials
        - secretRef:
            name: ums-provisioning-udm-transformer-ldap-credentials
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/provisioning-udm-transformer:0.44.0@sha256:1aca5eaa575ab0ee7b9fa128de30050b748a182b53b7bcdc6293b58187f5416a
        imagePullPolicy: IfNotPresent
        livenessProbe:
          exec:
            command:
            - sh
            - -c
            - 'exit 0

              '
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          timeoutSeconds: 5
        name: udm-transformer
        readinessProbe:
          exec:
            command:
            - sh
            - -c
            - 'exit 0

              '
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 1
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 64Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        startupProbe:
          exec:
            command:
            - sh
            - -c
            - 'exit 0

              '
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          timeoutSeconds: 5
        volumeMounts:
        - mountPath: /etc/univention/base.conf
          name: config-map-ucr
          subPath: base.conf
        - mountPath: /etc/univention/base-defaults.conf
          name: config-map-ucr
          subPath: base-defaults.conf
        - mountPath: /usr/lib/python3/dist-packages/univention/udm/modules
          name: plugin-targets
          subPath: udm-modules
        - mountPath: /usr/lib/python3/dist-packages/univention/admin/hooks.d
          name: plugin-targets
          subPath: udm-hooks.d
        - mountPath: /usr/lib/python3/dist-packages/univention/admin/syntax.d
          name: plugin-targets
          subPath: udm-syntax.d
        - mountPath: /usr/lib/python3/dist-packages/univention/admin/handlers
          name: plugin-targets
          subPath: udm-handlers
      initContainers:
      - command:
        - sh
        - -c
        - 'cp -av /usr/lib/python3/dist-packages/univention/udm/modules /target/udm-modules

          cp -av /usr/lib/python3/dist-packages/univention/admin/hooks.d /target/udm-hooks.d

          cp -av /usr/lib/python3/dist-packages/univention/admin/syntax.d /target/udm-syntax.d

          cp -av /usr/lib/python3/dist-packages/univention/admin/handlers /target/udm-handlers

          '
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/provisioning-udm-transformer:0.44.0@sha256:1aca5eaa575ab0ee7b9fa128de30050b748a182b53b7bcdc6293b58187f5416a
        imagePullPolicy: IfNotPresent
        name: load-internal-plugins
        resources: null
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /target
          name: plugin-targets
      - image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/portal-extension:0.38.0@sha256:aa6ec6b99810e05655d98fa1192bc2eabb855335f7a04aa4cd96ed5b5645d736
        imagePullPolicy: IfNotPresent
        name: load-portal-extension
        resources: null
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /target
          name: plugin-targets
      - image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/ox-extension:0.11.0@sha256:2cb5a9683b6ff81b995a5c71da52c2ff8177b662bb0be8f11e9cd0c6b48d8a11
        imagePullPolicy: IfNotPresent
        name: load-ox-extension
        resources: null
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /target
          name: plugin-targets
      - image: registry.opencode.de/bmi/opendesk/components/platform-development/images/opendesk-nubus:1.7.5@sha256:cc38d339abea18dc3644b7764d7be13798956161d1c87e34b26b5d8b7a11edc6
        imagePullPolicy: IfNotPresent
        name: load-opendesk-extension
        resources: null
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /target
          name: plugin-targets
      - command:
        - poetry
        - run
        - python
        - /scripts/wait-for-nats.py
        envFrom:
        - configMapRef:
            name: ums-provisioning-common
        - configMapRef:
            name: ums-provisioning-api
        - secretRef:
            name: ums-provisioning-api-credentials
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/provisioning-events-and-consumer-api:0.44.0@sha256:b87218dcd2db7539b786ff479cde9620939274d4365721531dc6075b6fcc19ea
        imagePullPolicy: IfNotPresent
        name: wait-for-nats
        resources:
          limits:
            cpu: 288
            memory: 1Gi
          requests:
            cpu: 10m
            memory: 16Mi
        volumeMounts:
        - mountPath: /scripts
          name: wait-for-nats
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: Always
        sysctls:
        - name: net.ipv4.ip_unprivileged_port_start
          value: '1'
      serviceAccountName: ums-provisioning
      terminationGracePeriodSeconds: 5
      volumes:
      - configMap:
          name: ums-provisioning-api
        name: wait-for-nats
      - configMap:
          name: ums-stack-data-ums-ucr
        name: config-map-ucr
      - emptyDir: {}
        name: plugin-targets
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: ums
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: ums-selfservice-listener
    app.kubernetes.io/version: 0.0.1
    helm.sh/chart: nubusSelfServiceConsumer-0.11.3
  name: ums-selfservice-listener
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: ums
      app.kubernetes.io/name: ums-selfservice-listener
  template:
    metadata:
      annotations:
        checksum/configmap: 149a77de8a55badb9337f7adaacdebb5f5565968ddc379e7aebc1f60ef4ddbba
        intents.otterize.com/service-name: ums-selfservice-listener
      labels:
        app.kubernetes.io/instance: ums
        app.kubernetes.io/name: ums-selfservice-listener
    spec:
      containers:
      - command:
        - /bin/bash
        - -c
        - 'set -euxo pipefail

          poetry run python3 -m invitation

          '
        env:
        - name: PROVISIONING_API_PASSWORD
          valueFrom:
            secretKeyRef:
              key: PROVISIONING_API_PASSWORD
              name: ums-selfservice-listener-credentials
        envFrom:
        - configMapRef:
            name: ums-selfservice-listener-common
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/selfservice-invitation:0.11.3@sha256:cd51246ae9436426bd7ee12bc85466cafc18a43ba05ab3ede35dfcf3a012656f
        imagePullPolicy: IfNotPresent
        livenessProbe: null
        name: selfservice-listener
        readinessProbe: null
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        startupProbe: null
        volumeMounts: null
      initContainers:
      - command:
        - /bin/bash
        - /scripts/wait-for-provisioning-api.sh
        env:
        - name: PROVISIONING_API_PASSWORD
          valueFrom:
            secretKeyRef:
              key: PROVISIONING_API_PASSWORD
              name: ums-selfservice-listener-credentials
        envFrom:
        - configMapRef:
            name: ums-selfservice-listener-common
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/wait-for-dependency:0.26.0@sha256:a31fde86bf21c597a31356fe492ab7e7a03a89282ca215eb7100763d6eb96b6b
        imagePullPolicy: IfNotPresent
        name: wait-for-provisioning-api
        resources: null
        volumeMounts:
        - mountPath: /scripts
          name: scripts
      serviceAccountName: ums-selfservice-listener
      terminationGracePeriodSeconds: 5
      volumes:
      - configMap:
          defaultMode: 365
          name: ums-selfservice-listener-scripts
        name: scripts
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    intents.otterize.com/service-name: ums-udm-rest-api
  labels:
    app.kubernetes.io/instance: ums
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: udm-rest-api
    app.kubernetes.io/version: 12.0.7
    helm.sh/chart: nubusUdmRestApi-0.25.1
  name: ums-udm-rest-api
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: ums
      app.kubernetes.io/name: udm-rest-api
  strategy:
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/configmap: f89d4c2bfc00dfccbd514228d03c0ff460b1bbaf3083c943840bacee06a13a44
      labels:
        app.kubernetes.io/instance: ums
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: udm-rest-api
        app.kubernetes.io/version: 12.0.7
        helm.sh/chart: nubusUdmRestApi-0.25.1
    spec:
      containers:
      - command:
        - sh
        - -c
        - 'python3 \

          -m "univention.admin.rest.server" \

          --debug "2" \

          --port "9979" \

          --interface "0.0.0.0" \

          --processes "1"

          '
        envFrom:
        - configMapRef:
            name: ums-udm-rest-api
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/udm-rest-api:0.25.1@sha256:0078b16ecf5539e6f3c7e6d5a7ddb57937d3d2d143754fbd6d439a3a8741abe8
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: 9979
          timeoutSeconds: 5
        name: udm-rest-api
        ports:
        - containerPort: 9979
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: 9979
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        startupProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: 9979
          timeoutSeconds: 5
        volumeMounts:
        - mountPath: /usr/lib/python3
          name: usr-lib-python3-volume
        - mountPath: /var/log/univention
          name: var-log-univention-volume
        - mountPath: /tmp
          name: tmp-volume
        - mountPath: /var/run
          name: var-run-volume
        - mountPath: /etc/ldap
          name: etc-ldap-volume
        - mountPath: /etc/univention
          name: etc-univention-volume
        - mountPath: /etc/ldap.secret
          name: credentials-volume
          subPath: ldap.secret
        - mountPath: /etc/machine.secret
          name: credentials-volume
          subPath: machine.secret
        - mountPath: /usr/lib/python3/dist-packages/univention/udm/modules
          name: plugin-targets
          subPath: udm-modules
        - mountPath: /usr/lib/python3/dist-packages/univention/admin/hooks.d
          name: plugin-targets
          subPath: udm-hooks.d
        - mountPath: /usr/lib/python3/dist-packages/univention/admin/syntax.d
          name: plugin-targets
          subPath: udm-syntax.d
        - mountPath: /usr/lib/python3/dist-packages/univention/admin/handlers
          name: plugin-targets
          subPath: udm-handlers
        - mountPath: /usr/share/univention-management-console-frontend/js/dijit/themes/umc/icons/
          name: plugin-targets
          subPath: umc-icons
        - mountPath: /etc/univention/base.conf
          name: config-map-ucr
          subPath: base.conf
        - mountPath: /etc/univention/base-defaults.conf
          name: config-map-ucr
          subPath: base-defaults.conf
      initContainers:
      - command:
        - sh
        - -c
        - cp -a /etc/univention/* /target/etc/univention/; cp -a /usr/lib/python3/*
          /target/usr/lib/python3/;
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/udm-rest-api:0.25.1@sha256:0078b16ecf5539e6f3c7e6d5a7ddb57937d3d2d143754fbd6d439a3a8741abe8
        imagePullPolicy: IfNotPresent
        name: univention-compatibility
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /target/etc/univention
          name: etc-univention-volume
        - mountPath: /target/usr/lib/python3
          name: usr-lib-python3-volume
      - command:
        - sh
        - -c
        - ucr commit /etc/univention/directory/reports/config.ini
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/udm-rest-api:0.25.1@sha256:0078b16ecf5539e6f3c7e6d5a7ddb57937d3d2d143754fbd6d439a3a8741abe8
        imagePullPolicy: IfNotPresent
        name: ucr-commit
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /etc/univention
          name: etc-univention-volume
        - mountPath: /var/cache/univention-config
          name: var-cache-univention-config-volume
      - command:
        - sh
        - -c
        - 'cp -av /usr/lib/python3/dist-packages/univention/udm/modules /target/udm-modules

          cp -av /usr/lib/python3/dist-packages/univention/admin/hooks.d /target/udm-hooks.d

          cp -av /usr/lib/python3/dist-packages/univention/admin/syntax.d /target/udm-syntax.d

          cp -av /usr/lib/python3/dist-packages/univention/admin/handlers /target/udm-handlers

          cp -av /usr/share/univention-management-console-frontend/js/dijit/themes/umc/icons
          /target/umc-icons

          '
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/udm-rest-api:0.25.1@sha256:0078b16ecf5539e6f3c7e6d5a7ddb57937d3d2d143754fbd6d439a3a8741abe8
        imagePullPolicy: IfNotPresent
        name: load-internal-plugins
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /target
          name: plugin-targets
      - image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/portal-extension:0.38.0@sha256:aa6ec6b99810e05655d98fa1192bc2eabb855335f7a04aa4cd96ed5b5645d736
        imagePullPolicy: IfNotPresent
        name: load-portal-extension
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /target
          name: plugin-targets
      - image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/ox-extension:0.11.0@sha256:2cb5a9683b6ff81b995a5c71da52c2ff8177b662bb0be8f11e9cd0c6b48d8a11
        imagePullPolicy: IfNotPresent
        name: load-ox-extension
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /target
          name: plugin-targets
      - image: registry.opencode.de/bmi/opendesk/components/platform-development/images/opendesk-nubus:1.7.5@sha256:cc38d339abea18dc3644b7764d7be13798956161d1c87e34b26b5d8b7a11edc6
        imagePullPolicy: IfNotPresent
        name: load-opendesk-extension
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /target
          name: plugin-targets
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: Always
      serviceAccountName: ums-udm-rest-api
      terminationGracePeriodSeconds: 5
      volumes:
      - emptyDir: {}
        name: usr-lib-python3-volume
      - configMap:
          name: ums-udm-rest-api-ldap-conf
        name: etc-ldap-volume
      - emptyDir: {}
        name: var-cache-univention-config-volume
      - emptyDir: {}
        name: tmp-volume
      - emptyDir: {}
        name: var-run-volume
      - emptyDir: {}
        name: var-log-univention-volume
      - emptyDir: {}
        name: etc-univention-volume
      - emptyDir: {}
        name: plugin-targets
      - name: credentials-volume
        secret:
          defaultMode: 420
          secretName: ums-udm-rest-api-credentials
      - configMap:
          name: ums-stack-data-ums-ucr
        name: config-map-ucr
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: ums
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: umc-gateway
    app.kubernetes.io/version: 12.0.29
    helm.sh/chart: nubusUmcGateway-0.34.1
  name: ums-umc-gateway
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: ums
      app.kubernetes.io/name: umc-gateway
  strategy: null
  template:
    metadata:
      annotations: null
      labels:
        app.kubernetes.io/instance: ums
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: umc-gateway
        app.kubernetes.io/version: 12.0.29
        helm.sh/chart: nubusUmcGateway-0.34.1
    spec:
      containers:
      - command:
        - bash
        - -c
        - 'apache2 -D FOREGROUND \

          -d /etc/apache2/ \

          -f /etc/apache2/apache2.conf

          '
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/umc-gateway:0.34.1@sha256:ab4ffccc182bae115dc8f264c051f1c23102b1416ac00709d95285218829ce39
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 30
          successThreshold: 1
          tcpSocket:
            port: 8080
          timeoutSeconds: 3
        name: umc-gateway
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 30
          initialDelaySeconds: 10
          periodSeconds: 15
          successThreshold: 1
          tcpSocket:
            port: 8080
          timeoutSeconds: 3
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /etc/univention/base.conf
          name: config-map-ucr
          subPath: base.conf
        - mountPath: /etc/univention/base-defaults.conf
          name: config-map-ucr
          subPath: base-defaults.conf
        - mountPath: /usr/share/univention-management-console-frontend/js/dijit/themes/umc/icons/
          name: plugin-targets
          readOnly: true
          subPath: umc-icons
        - mountPath: /usr/local/apache2/logs
          name: apache2-logs
        - mountPath: /etc/apache2
          name: etc-apache2
          readOnly: true
        - mountPath: /var/www/univention
          name: var-www-univention
          readOnly: true
      initContainers:
      - command:
        - bash
        - -c
        - 'cp -a /etc/univention/* /target/etc/univention/

          cp -a /etc/apache2/* /target/etc/apache2/

          cp -a /var/www/univention/* /target/var/www/univention/

          '
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/umc-gateway:0.34.1@sha256:ab4ffccc182bae115dc8f264c051f1c23102b1416ac00709d95285218829ce39
        imagePullPolicy: IfNotPresent
        name: copy-config
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /target/etc/apache2
          name: etc-apache2
        - mountPath: /target/var/www/univention
          name: var-www-univention
        - mountPath: /target/etc/univention
          name: etc-univention
      - command:
        - bash
        - -c
        - '/entrypoint.d/50-entrypoint.sh

          echo "Listen 8080" > /etc/apache2/ports.conf

          sed -e ''s,<VirtualHost \*:80>,<VirtualHost *:8080>,g'' -i /etc/apache2/sites-available/000-default.conf

          cat /etc/apache2/sites-available/000-default.conf

          '
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/umc-gateway:0.34.1@sha256:ab4ffccc182bae115dc8f264c051f1c23102b1416ac00709d95285218829ce39
        imagePullPolicy: IfNotPresent
        name: prepare-config
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /etc/apache2
          name: etc-apache2
        - mountPath: /var/www/univention
          name: var-www-univention
        - mountPath: /etc/univention
          name: etc-univention
        - mountPath: /var/cache/univention-config
          name: config-cache
        - mountPath: /var/log/univention
          name: univention-logs
        - mountPath: /etc/univention/base.conf
          name: config-map-ucr
          subPath: base.conf
        - mountPath: /etc/univention/base-defaults.conf
          name: config-map-ucr
          subPath: base-defaults.conf
      - command:
        - sh
        - -c
        - 'cp -av /usr/share/univention-management-console-frontend/js/dijit/themes/umc/icons
          /target/umc-icons

          '
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/umc-gateway:0.34.1@sha256:ab4ffccc182bae115dc8f264c051f1c23102b1416ac00709d95285218829ce39
        imagePullPolicy: IfNotPresent
        name: load-internal-plugins
        resources: null
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /target
          name: plugin-targets
      - image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/portal-extension:0.38.0@sha256:aa6ec6b99810e05655d98fa1192bc2eabb855335f7a04aa4cd96ed5b5645d736
        imagePullPolicy: IfNotPresent
        name: load-portal-extension
        resources: null
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /target
          name: plugin-targets
      - image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/ox-extension:0.11.0@sha256:2cb5a9683b6ff81b995a5c71da52c2ff8177b662bb0be8f11e9cd0c6b48d8a11
        imagePullPolicy: IfNotPresent
        name: load-ox-extension
        resources: null
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /target
          name: plugin-targets
      - image: registry.opencode.de/bmi/opendesk/components/platform-development/images/opendesk-nubus:1.7.5@sha256:cc38d339abea18dc3644b7764d7be13798956161d1c87e34b26b5d8b7a11edc6
        imagePullPolicy: IfNotPresent
        name: load-opendesk-extension
        resources: null
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /target
          name: plugin-targets
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: Always
      serviceAccountName: ums-umc-gateway
      terminationGracePeriodSeconds: 5
      volumes:
      - configMap:
          name: ums-stack-data-ums-ucr
        name: config-map-ucr
      - emptyDir: {}
        name: plugin-targets
      - emptyDir:
          medium: Memory
        name: apache2-logs
      - emptyDir:
          medium: Memory
        name: etc-apache2
      - emptyDir:
          medium: Memory
        name: var-www-univention
      - emptyDir:
          medium: Memory
        name: etc-univention
      - emptyDir:
          medium: Memory
        name: config-cache
      - emptyDir:
          medium: Memory
        name: univention-logs
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    intents.otterize.com/service-name: ums-umc-server
  labels:
    app.kubernetes.io/instance: ums
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: ums-umc-server-proxy
    app.kubernetes.io/version: 12.0.29
    helm.sh/chart: nubusUmcServer-0.34.1
  name: ums-umc-server
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: ums
      app.kubernetes.io/name: ums-umc-server-proxy
  strategy: null
  template:
    metadata:
      annotations:
        checksum/configmap: d2a7ee1168c85919e07656ab6d51134351a784a292d7070db616ba07d73560f8
      labels:
        app.kubernetes.io/instance: ums
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: ums-umc-server-proxy
        app.kubernetes.io/version: 12.0.29
        helm.sh/chart: nubusUmcServer-0.34.1
    spec:
      containers:
      - image: registry-1.docker.io/library/traefik:3.0@sha256:a208c74fd80a566d4ea376053bff73d31616d7af3f1465a7747b8b89ee34d97e
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /ping
            port: 8080
          initialDelaySeconds: 10
          periodSeconds: 30
          successThreshold: 1
          timeoutSeconds: 3
        name: proxy
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 30
          httpGet:
            path: /ping
            port: 8080
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 3
        resources:
          limits:
            cpu: 99
            memory: 2Gi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /var/secrets/ssl
          name: certificates
        - mountPath: /etc/traefik
          name: traefik
      securityContext:
        fsGroup: 0
        fsGroupChangePolicy: Always
      serviceAccountName: ums-umc-server
      terminationGracePeriodSeconds: 5
      volumes:
      - name: certificates
        secret:
          secretName: ums-saml-tls
      - configMap:
          items:
          - key: traefik.yaml
            path: traefik.yaml
          - key: dynamic.yaml
            path: dynamic.yaml
          name: ums-umc-server-proxy
        name: traefik
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: intercom-service
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: intercom-service
    app.kubernetes.io/version: '1.4'
    helm.sh/chart: intercom-service-2.4.0
  name: intercom-service
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: intercom-service
      app.kubernetes.io/name: intercom-service
  strategy:
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/secret: d80697b3e3abe0f27cc85fd61f94b7ee1360350a28f35c54393f12fc94b9890b
      labels:
        app.kubernetes.io/instance: intercom-service
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: intercom-service
        app.kubernetes.io/version: '1.4'
        helm.sh/chart: intercom-service-2.4.0
    spec:
      containers:
      - env: null
        envFrom:
        - secretRef:
            name: intercom-service
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/intercom-service:2.4.0@sha256:df743b7ea30077dc941815ccc60198820d67bbba94853fa7a6f939c0f36af335
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          initialDelaySeconds: 15
          periodSeconds: 5
          successThreshold: 1
          tcpSocket:
            port: http
          timeoutSeconds: 2
        name: intercom-service
        ports:
        - containerPort: 8008
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 15
          initialDelaySeconds: 5
          periodSeconds: 5
          successThreshold: 1
          tcpSocket:
            port: http
          timeoutSeconds: 1
        resources:
          limits:
            cpu: 99
            memory: 128Mi
          requests:
            cpu: 0.1
            memory: 64Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts: null
      initContainers:
      - command:
        - /usr/bin/python3
        - /scripts/wait-for-keycloak.py
        envFrom:
        - configMapRef:
            name: intercom-service-provisioning-init
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/wait-for-dependency:0.26.0@sha256:a31fde86bf21c597a31356fe492ab7e7a03a89282ca215eb7100763d6eb96b6b
        imagePullPolicy: IfNotPresent
        name: wait-for-keycloak-container
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /scripts
          name: wait-for-keycloak
      - command:
        - /bin/bash
        - -c
        - 'univention-keycloak \

          --keycloak-url $KEYCLOAK_URL \

          --realm $KEYCLOAK_REALM \

          --binduser $KEYCLOAK_USERNAME \

          --bindpwdfile /credentials/keycloak.secret \

          oidc/rp create \

          opendesk-intercom \

          --direct-access-grants \

          --backchannel-logout-url $KEYCLOAK_APP_BASE_URL/backchannel-logout \

          --web-origins $KEYCLOAK_APP_BASE_URL \

          --client-secret $ICS_CLIENT_SECRET \

          --redirect-uri $KEYCLOAK_APP_BASE_URL/callback \

          --add-ics-mappers \

          --backchannel-logout-revoke-session \

          --pkce-code-challenge-method "" \

          --host-fqdn $KEYCLOAK_HOST

          '
        env:
        - name: KEYCLOAK_PASSWORD
          valueFrom:
            secretKeyRef:
              key: admin_password
              name: ums-opendesk-keycloak-credentials
        - name: ICS_CLIENT_SECRET
          value: 3b751c9f18664b9d4067ff610f25f957df82d0a0
        envFrom:
        - configMapRef:
            name: intercom-service-provisioning-env
        image: registry.opencode.de/bmi/opendesk/components/supplier/univention/images-mirror/keycloak-bootstrap:0.3.0@sha256:2911e8d5409f4e302b5c8c073cc6bf3f3622582e6eef43c63672ac4551712750
        imagePullPolicy: IfNotPresent
        name: keycloak-provisioning
        securityContext:
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /credentials/keycloak.secret
          name: keycloak-credentials-volume
          subPath: admin_password
        - mountPath: /tmp
          name: temp-dir
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: Always
      serviceAccountName: intercom-service
      volumes:
      - configMap:
          name: intercom-service-provisioning-init
        name: wait-for-keycloak
      - name: keycloak-credentials-volume
        secret:
          secretName: ums-opendesk-keycloak-credentials
      - emptyDir:
          sizeLimit: 20Mi
        name: temp-dir
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: dovecot
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: dovecot
    helm.sh/chart: dovecot-1.4.0
  name: dovecot
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: dovecot
      app.kubernetes.io/name: dovecot
  strategy:
    type: Recreate
  template:
    metadata:
      annotations:
        checksum/configmap: 6d061ac921d6ae7943fb9b0ab0e8f5ff627c95bf0b0b62dce99cc2d46aba921d
      labels:
        app.kubernetes.io/instance: dovecot
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: dovecot
        helm.sh/chart: dovecot-1.4.0
    spec:
      containers:
      - env: null
        image: registry.opencode.de/bmi/opendesk/components/supplier/open-xchange/images/dovecot-public-sector:2.3.21@sha256:c76965a84d1ca527f523404eb027119f6736b199c094e4671037cb345ecad3dc
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: imap
          timeoutSeconds: 5
        name: dovecot
        ports:
        - containerPort: 3659
          name: auth
          protocol: null
        - containerPort: 9000
          name: doveadm
          protocol: null
        - containerPort: 9200
          name: doveadm2
          protocol: null
        - containerPort: 8080
          name: doveadmhttp
          protocol: null
        - containerPort: 143
          name: imap
          protocol: null
        - containerPort: 993
          name: imaps
          protocol: null
        - containerPort: 24
          name: lmpt
          protocol: null
        - containerPort: 4190
          name: managasieve
          protocol: null
        - containerPort: 9900
          name: openmetrics
          protocol: null
        - containerPort: 110
          name: pop3
          protocol: null
        - containerPort: 995
          name: pop3s
          protocol: null
        readinessProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 15
          successThreshold: 1
          tcpSocket:
            port: imap
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 256Mi
          requests:
            cpu: 0.1
            memory: 32Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            add:
            - CHOWN
            - DAC_OVERRIDE
            - KILL
            - NET_BIND_SERVICE
            - SETGID
            - SETUID
            - SYS_CHROOT
            drop:
            - ALL
          readOnlyRootFilesystem: true
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /etc/dovecot
          name: config-volume
        - mountPath: /etc/dovecot/virtual/All
          name: config-virtual-volume
        - mountPath: /etc/tls
          name: tls-volume
        - mountPath: /srv/mail
          name: srv-mail
        - mountPath: /run/dovecot
          name: run-dovecot
        - mountPath: /var/lib/dovecot
          name: var-lib-dovecot
      securityContext:
        fsGroup: 1000
      serviceAccountName: dovecot
      volumes:
      - configMap:
          name: dovecot
        name: config-volume
      - configMap:
          name: dovecot-virtual
        name: config-virtual-volume
      - name: tls-volume
        secret:
          secretName: opendesk-certificates-tls
      - name: srv-mail
        persistentVolumeClaim:
          claimName: dovecot
      - emptyDir:
          sizeLimit: 10Mi
        name: run-dovecot
      - emptyDir:
          sizeLimit: 100Mi
        name: var-lib-dovecot
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: core-documentconverter
    app.kubernetes.io/instance: open-xchange
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: core-documentconverter
    helm.sh/chart: core-documentconverter-2.28.0
    version: 8.30.0
  name: open-xchange-core-documentconverter
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: open-xchange
      app.kubernetes.io/name: core-documentconverter
  template:
    metadata:
      annotations:
        checksum/commonEnv: 93891d51872fb4c118b8683aaf5dd02df333180f42a7579e784e08e798851d58
        commit.open-xchange.com/backend: 8347272db983dbd9f11efed0f107a5d6145fc789
        commit.open-xchange.com/documentconverter: 79b75d928fabf50a993c5d87848e5a054b9aa6d4
        commit.open-xchange.com/documentconverter-api: 6903464ecc527debdcaacf2a603067cc8bd5b723
        logging.open-xchange.com/format: appsuite-json
      labels:
        app: core-documentconverter
        app.kubernetes.io/instance: open-xchange
        app.kubernetes.io/name: core-documentconverter
        version: 8.30.0
    spec:
      affinity: {}
      containers:
      - env:
        - name: CONSOLELOG
          value: /dev/tty
        - name: DC_JVM_HEAP_SIZE_MB
          value: '768'
        - name: DC_JVM_HEAP_MIN_RAM_PERCENTAGE
          value: null
        - name: DC_JVM_HEAP_MAX_RAM_PERCENTAGE
          value: null
        - name: RELEASE_NAMESPACE
          value: open-xchange
        - name: OX_BLACKLISTED_PACKAGES
          value: none
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        envFrom:
        - secretRef:
            name: open-xchange-common-env
        - secretRef:
            name: open-xchange-core-documentconverter-envvars
        image: registry.opencode.de/bmi/opendesk/components/supplier/open-xchange/images-mirror/documentconverter:8.30.60@sha256:4b3c79f94beec71f1b3e6c1be3cb4894d25e3a3133390cb077bf6fa749cecbe8
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 15
          httpGet:
            path: /live
            port: http-live
          periodSeconds: 10
        name: main
        ports:
        - containerPort: 8008
          name: http
          protocol: TCP
        - containerPort: 8011
          name: https
          protocol: TCP
        - containerPort: 8017
          name: http-live
          protocol: TCP
        readinessProbe:
          failureThreshold: 2
          httpGet:
            path: /documentconverterws
            port: http
          initialDelaySeconds: 30
          periodSeconds: 5
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 2Gi
          requests:
            cpu: 0.25
            memory: 1.25Gi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: false
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 987
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        startupProbe:
          failureThreshold: 30
          httpGet:
            path: /live
            port: http-live
          initialDelaySeconds: 30
          periodSeconds: 10
        volumeMounts:
        - mountPath: /opt/open-xchange/etc/configdb.properties
          name: db-config
          subPath: configdb.properties
        - mountPath: /opt/open-xchange/etc/logback.xml
          name: log-config
          subPath: logback.xml
        - mountPath: /opt/open-xchange/etc2/dcconfig.properties
          name: dc-config
          subPath: dcconfig.properties
        - mountPath: /var/log/open-xchange/documentconverter
          name: dc-logs
        - mountPath: /var/spool/open-xchange
          name: dc-spool
        - mountPath: /opt/open-xchange/etc/readerengine.whitelist
          name: dc-urlallow
          subPath: readerengine.whitelist
        - mountPath: /opt/open-xchange/etc/readerengine.blacklist
          name: dc-urldeny
          subPath: readerengine.blacklist
      imagePullSecrets: []
      nodeSelector: {}
      serviceAccountName: default
      tolerations: []
      volumes:
      - configMap:
          items:
          - key: configdb.properties
            path: configdb.properties
          name: open-xchange-core-documentconverter-dc-configmap
        name: db-config
      - configMap:
          items:
          - key: logback.xml
            path: logback.xml
          name: open-xchange-core-documentconverter-dc-configmap
        name: log-config
      - configMap:
          items:
          - key: dcconfig.properties
            path: dcconfig.properties
          name: open-xchange-core-documentconverter-dc-configmap
        name: dc-config
      - emptyDir: {}
        name: dc-logs
      - emptyDir: {}
        name: dc-spool
      - configMap:
          items:
          - key: readerengine.whitelist
            path: readerengine.whitelist
          name: open-xchange-core-documentconverter-dc-configmap
        name: dc-urlallow
      - configMap:
          items:
          - key: readerengine.blacklist
            path: readerengine.blacklist
          name: open-xchange-core-documentconverter-dc-configmap
        name: dc-urldeny
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: core-guidedtours
    app.kubernetes.io/instance: open-xchange
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: core-guidedtours
    helm.sh/chart: core-guidedtours-2.6.10
    version: 8.6.9
  name: open-xchange-core-guidedtours
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: open-xchange
      app.kubernetes.io/name: core-guidedtours
  template:
    metadata:
      annotations:
        commit.open-xchange.com/core-guidedtours: b4c3cb5bbfe464dd6e3f8a9cba895dd8a30fb9a9
      labels:
        app: core-guidedtours
        app.kubernetes.io/instance: open-xchange
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: core-guidedtours
        helm.sh/chart: core-guidedtours-2.6.10
        version: 8.6.9
    spec:
      affinity: {}
      containers:
      - image: registry.opencode.de/bmi/opendesk/components/supplier/open-xchange/images-mirror/core-guidedtours:8.6.9@sha256:c6ce1047292937af2f153ffa5f88d54955c90b52ed7b17a80efd112030dd2aa9
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 15
          httpGet:
            path: /
            port: 8080
          periodSeconds: 10
        name: main
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 2
          httpGet:
            path: /
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 5
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 96Mi
          requests:
            cpu: 0.01
            memory: 32Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /tmp
          name: tmp
      imagePullSecrets: []
      nodeSelector: {}
      securityContext:
        runAsGroup: 1000
        runAsNonRoot: true
        runAsUser: 1000
      serviceAccountName: default
      tolerations: []
      volumes:
      - emptyDir: {}
        name: tmp
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: core-imageconverter
    app.kubernetes.io/instance: open-xchange
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: core-imageconverter
    helm.sh/chart: core-imageconverter-2.29.0
    version: 8.30.0
  name: open-xchange-core-imageconverter
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: open-xchange
      app.kubernetes.io/name: core-imageconverter
  template:
    metadata:
      annotations:
        checksum/commonEnv: 472464e265c2f176c33c89b5204553491319d14b52bb3f97a1452e6bd2a2f2c3
        commit.open-xchange.com/backend: 8347272db983dbd9f11efed0f107a5d6145fc789
        commit.open-xchange.com/imageconverter: fbcc4654551274cce4418a91e2f5920742261259
        logging.open-xchange.com/format: appsuite-json
      labels:
        app: core-imageconverter
        app.kubernetes.io/instance: open-xchange
        app.kubernetes.io/name: core-imageconverter
        version: 8.30.0
    spec:
      affinity: {}
      containers:
      - env:
        - name: CONSOLELOG
          value: /dev/tty
        - name: IC_JVM_HEAP_SIZE_MB
          value: '1024'
        - name: RELEASE_NAMESPACE
          value: open-xchange
        - name: OX_BLACKLISTED_PACKAGES
          value: none
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: OXENV_OBJECTSTOREID
          value: null
        envFrom:
        - secretRef:
            name: open-xchange-common-env
        - secretRef:
            name: open-xchange-core-imageconverter-envvars
        image: registry.opencode.de/bmi/opendesk/components/supplier/open-xchange/images-mirror/imageconverter:8.30.61@sha256:816008c99e38a7268a323c2c144f1855275c53ea678cd6fdf2ff2170bd7bcfac
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 15
          httpGet:
            path: /live
            port: http-live
          periodSeconds: 10
        name: main
        ports:
        - containerPort: 8005
          name: http
          protocol: TCP
        - containerPort: 8014
          name: https
          protocol: TCP
        - containerPort: 8018
          name: http-live
          protocol: TCP
        readinessProbe:
          failureThreshold: 2
          httpGet:
            path: /imageconverter
            port: http
          initialDelaySeconds: 30
          periodSeconds: 5
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 2Gi
          requests:
            cpu: 0.5
            memory: 1.25Gi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: false
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 987
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        startupProbe:
          failureThreshold: 30
          httpGet:
            path: /live
            port: http-live
          initialDelaySeconds: 30
          periodSeconds: 10
        volumeMounts:
        - mountPath: /opt/open-xchange/etc/configdb.properties
          name: db-config
          subPath: configdb.properties
        - mountPath: /opt/open-xchange/etc/logback.xml
          name: log-config
          subPath: logback.xml
        - mountPath: /opt/open-xchange/etc2/icconfig.properties
          name: ic-config
          subPath: icconfig.properties
        - mountPath: /var/log/open-xchange/imageconverter
          name: ic-logs
        - mountPath: /var/spool/open-xchange
          name: ic-spool
      imagePullSecrets: []
      nodeSelector: {}
      serviceAccountName: default
      tolerations: []
      volumes:
      - configMap:
          items:
          - key: configdb.properties
            path: configdb.properties
          name: open-xchange-core-imageconverter-ic-configmap
        name: db-config
      - configMap:
          items:
          - key: logback.xml
            path: logback.xml
          name: open-xchange-core-imageconverter-ic-configmap
        name: log-config
      - configMap:
          items:
          - key: icconfig.properties
            path: icconfig.properties
          name: open-xchange-core-imageconverter-ic-configmap
        name: ic-config
      - emptyDir: {}
        name: ic-logs
      - emptyDir: {}
        name: ic-spool
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: open-xchange
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: gotenberg
    app.kubernetes.io/version: 8.1.0
    helm.sh/chart: gotenberg-1.1.0
  name: open-xchange-gotenberg
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: open-xchange
      app.kubernetes.io/name: gotenberg
  template:
    metadata:
      labels:
        app.kubernetes.io/instance: open-xchange
        app.kubernetes.io/name: gotenberg
    spec:
      containers:
      - args:
        - gotenberg
        - --api-port=3000
        - --chromium-disable-javascript
        - --gotenberg-graceful-shutdown-duration=30s
        image: registry.opencode.de/bmi/opendesk/components/supplier/open-xchange/images-mirror/gotenberg:8.2.0@sha256:ec5afe8eea496d3bef6c42291fde9c203c20e8a68189a2314ef876e9c0e67680
        imagePullPolicy: IfNotPresent
        livenessProbe:
          httpGet:
            path: /health
            port: http
        name: gotenberg
        ports:
        - containerPort: 3000
          name: http
          protocol: TCP
        readinessProbe:
          httpGet:
            path: /health
            port: http
        resources:
          limits:
            cpu: 99
            memory: 96Mi
          requests:
            cpu: 0.05
            memory: 32Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1001
          runAsNonRoot: true
          runAsUser: 1001
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /tmp
          name: tmp-volume
      securityContext: {}
      serviceAccountName: default
      terminationGracePeriodSeconds: 30
      volumes:
      - emptyDir:
          medium: Memory
          sizeLimit: 256Mi
        name: tmp-volume
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: core-ui-middleware
    app.kubernetes.io/instance: open-xchange
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: core-ui-middleware
    helm.sh/chart: core-ui-middleware-3.2.0
    version: 2.1.0
  name: open-xchange-core-ui-middleware
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: open-xchange
      app.kubernetes.io/name: core-ui-middleware
  template:
    metadata:
      annotations:
        commit.open-xchange.com/core-ui-middleware: e402ee0e6f74e8f44beefc0d883cc4b967a4226f
        logging.open-xchange.com/format: appsuite-json
      labels:
        app: core-ui-middleware
        app.kubernetes.io/instance: open-xchange
        app.kubernetes.io/name: core-ui-middleware
        version: 2.1.0
    spec:
      affinity: {}
      containers:
      - env:
        - name: CACHE_TTL
          value: '30000'
        - name: LOG_LEVEL
          value: info
        - name: APP_ROOT
          value: /appsuite/
        - name: COMPRESS_FILE_SIZE
          value: '600'
        - name: COMPRESS_FILE_TYPES
          value: application/javascript application/json application/x-javascript
            application/xml application/xml+rss text/css text/html text/javascript
            text/plain text/xml image/svg+xml
        - name: SLOW_REQUEST_THRESHOLD
          value: '4000'
        - name: REDIS_MODE
          value: standalone
        - name: REDIS_HOSTS
          value: redis-master:6379
        - name: REDIS_DB
          value: '0'
        - name: REDIS_USERNAME
          valueFrom:
            secretKeyRef:
              key: username
              name: open-xchange-core-ui-middleware-redis
        - name: REDIS_PASSWORD
          valueFrom:
            secretKeyRef:
              key: password
              name: open-xchange-core-ui-middleware-redis
        - name: REDIS_PREFIX
          value: ui-middleware
        - name: REDIS_TLS_ENABLED
          value: 'false'
        image: registry.opencode.de/bmi/opendesk/components/supplier/open-xchange/images-mirror/core-ui-middleware:2.1.1@sha256:1a3e96243353a53e06bf3d90067d7d07de449e8273fa60a043d7ac4a5e6464c3
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 15
          httpGet:
            path: /live
            port: 9000
          periodSeconds: 10
        name: main
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 9090
          name: tcp-monitoring
          protocol: TCP
        readinessProbe:
          failureThreshold: 2
          httpGet:
            path: /ready
            port: 9000
          initialDelaySeconds: 1
          periodSeconds: 5
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 768Mi
          requests:
            cpu: 0.5
            memory: 192Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /app/config/
          name: manifest-config
      imagePullSecrets: []
      nodeSelector: {}
      securityContext:
        runAsGroup: 1000
        runAsNonRoot: true
        runAsUser: 1000
      serviceAccountName: default
      tolerations: []
      volumes:
      - configMap:
          name: open-xchange-core-ui-middleware
        name: manifest-config
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: core-ui-middleware
    app.kubernetes.io/instance: open-xchange
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: core-ui-middleware
    helm.sh/chart: core-ui-middleware-3.2.0
    version: 2.1.0
  name: open-xchange-core-ui-middleware-updater
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: open-xchange
      app.kubernetes.io/name: core-ui-middleware
  template:
    metadata:
      annotations:
        commit.open-xchange.com/core-ui-middleware: e402ee0e6f74e8f44beefc0d883cc4b967a4226f
        logging.open-xchange.com/format: appsuite-json
      labels:
        app: core-ui-middleware
        app.kubernetes.io/instance: open-xchange
        app.kubernetes.io/name: core-ui-middleware
        version: 2.1.0
    spec:
      affinity: {}
      containers:
      - command:
        - /nodejs/bin/node
        - src/updater.js
        env:
        - name: PROPAGATE_UPGRADES
          value: 'true'
        - name: CACHE_TTL
          value: '30000'
        - name: LOG_LEVEL
          value: info
        - name: APP_ROOT
          value: /appsuite/
        - name: COMPRESS_FILE_SIZE
          value: '600'
        - name: COMPRESS_FILE_TYPES
          value: application/javascript application/json application/x-javascript
            application/xml application/xml+rss text/css text/html text/javascript
            text/plain text/xml image/svg+xml
        - name: SLOW_REQUEST_THRESHOLD
          value: '4000'
        - name: REDIS_MODE
          value: standalone
        - name: REDIS_HOSTS
          value: redis-master:6379
        - name: REDIS_DB
          value: '0'
        - name: REDIS_USERNAME
          valueFrom:
            secretKeyRef:
              key: username
              name: open-xchange-core-ui-middleware-redis
        - name: REDIS_PASSWORD
          valueFrom:
            secretKeyRef:
              key: password
              name: open-xchange-core-ui-middleware-redis
        - name: REDIS_PREFIX
          value: ui-middleware
        - name: REDIS_TLS_ENABLED
          value: 'false'
        image: registry.opencode.de/bmi/opendesk/components/supplier/open-xchange/images-mirror/core-ui-middleware:2.1.1@sha256:1a3e96243353a53e06bf3d90067d7d07de449e8273fa60a043d7ac4a5e6464c3
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 15
          httpGet:
            path: /live
            port: 9000
          periodSeconds: 10
        name: main
        ports:
        - containerPort: 9090
          name: tcp-monitoring
          protocol: TCP
        readinessProbe:
          failureThreshold: 2
          httpGet:
            path: /ready
            port: 9000
          initialDelaySeconds: 1
          periodSeconds: 5
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 768Mi
          requests:
            cpu: 0.5
            memory: 192Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /app/config/
          name: manifest-config
      imagePullSecrets: []
      nodeSelector: {}
      securityContext:
        runAsGroup: 1000
        runAsNonRoot: true
        runAsUser: 1000
      serviceAccountName: default
      tolerations: []
      volumes:
      - configMap:
          name: open-xchange-core-ui-middleware
        name: manifest-config
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: core-ui
    app.kubernetes.io/instance: open-xchange
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: core-ui
    helm.sh/chart: core-ui-2.32.1
    version: 8.30.1
  name: open-xchange-core-ui
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: open-xchange
      app.kubernetes.io/name: core-ui
  template:
    metadata:
      annotations:
        commit.open-xchange.com/core-ui: 9d562a65c47c16f90243d290b83ee66e33dd98a3
      labels:
        app: core-ui
        app.kubernetes.io/instance: open-xchange
        app.kubernetes.io/name: core-ui
        version: 8.30.1
    spec:
      affinity: {}
      containers:
      - image: registry.opencode.de/bmi/opendesk/components/supplier/open-xchange/images-mirror/core-ui:8.30.1@sha256:bd15c87f0bd929be56dea260e35de0e089758eaf394c0eb4ece2991371c7ad5e
        imagePullPolicy: IfNotPresent
        name: main
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        resources:
          limits:
            cpu: 99
            memory: 96Mi
          requests:
            cpu: 0.01
            memory: 32Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /tmp
          name: tmp
      imagePullSecrets: []
      nodeSelector: {}
      securityContext:
        runAsGroup: 1000
        runAsNonRoot: true
        runAsUser: 1000
      serviceAccountName: default
      tolerations: []
      volumes:
      - emptyDir: {}
        name: tmp
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: core-user-guide
    app.kubernetes.io/instance: open-xchange
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: core-user-guide
    helm.sh/chart: core-user-guide-2.30.0
    version: 8.30.0
  name: open-xchange-core-user-guide
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: open-xchange
      app.kubernetes.io/name: core-user-guide
  template:
    metadata:
      annotations:
        commit.open-xchange.com/core-user-guide: 98a34b028f56303345665da0e55e8e4cbdf4382b
      labels:
        app.kubernetes.io/instance: open-xchange
        app.kubernetes.io/name: core-user-guide
    spec:
      affinity: {}
      containers:
      - image: registry.opencode.de/bmi/opendesk/components/supplier/open-xchange/images-mirror/core-user-guide:8.30.1161251@sha256:a082bcf5768c2cba22f36a4299665474af92fd18307a1de719fc541717aee0b7
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 15
          httpGet:
            path: /
            port: 8080
          periodSeconds: 10
        name: main
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 2
          httpGet:
            path: /
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 5
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 96Mi
          requests:
            cpu: 0.02
            memory: 32Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /tmp
          name: tmp
      imagePullSecrets: []
      nodeSelector: {}
      securityContext:
        runAsGroup: 1000
        runAsNonRoot: true
        runAsUser: 1000
      serviceAccountName: default
      tolerations: []
      volumes:
      - emptyDir: {}
        name: tmp
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: guard-ui
    app.kubernetes.io/instance: open-xchange
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: guard-ui
    helm.sh/chart: guard-ui-2.6.0
    version: 8.29.0
  name: open-xchange-guard-ui
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: open-xchange
      app.kubernetes.io/name: guard-ui
  template:
    metadata:
      annotations:
        commit.open-xchange.com/guard-ui: d763be9e536ccc7009eea779f3de5cdeebc3a84a
      labels:
        app: guard-ui
        app.kubernetes.io/instance: open-xchange
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: guard-ui
        helm.sh/chart: guard-ui-2.6.0
        version: 8.29.0
    spec:
      affinity: {}
      containers:
      - image: registry.opencode.de/bmi/opendesk/components/supplier/open-xchange/images-mirror/guard-ui:8.28.1@sha256:eed6a81f8393ce6ecdc8ea83507e0a734431a0eb8d30221f4cabe9fc7906e4e6
        imagePullPolicy: IfNotPresent
        livenessProbe:
          httpGet:
            path: /
            port: http
        name: guard-ui
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          httpGet:
            path: /
            port: http
        resources:
          limits:
            cpu: 99
            memory: 96Mi
          requests:
            cpu: 0.01
            memory: 32Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /tmp
          name: tmp
      imagePullSecrets: []
      nodeSelector: {}
      securityContext:
        runAsGroup: 1000
        runAsNonRoot: true
        runAsUser: 1000
      serviceAccountName: default
      tolerations: []
      volumes:
      - emptyDir: {}
        name: tmp
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: nextcloud-integration-ui
    app.kubernetes.io/instance: open-xchange
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: nextcloud-integration-ui
    helm.sh/chart: nextcloud-integration-ui-1.2.0
    version: 1.2.0
  name: open-xchange-nextcloud-integration-ui
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: open-xchange
      app.kubernetes.io/name: nextcloud-integration-ui
  template:
    metadata:
      annotations:
        commit.open-xchange.com/nextcloud-integration-ui: e1cdf2b55247bf7933b796480b7774298e58e622
      labels:
        app: nextcloud-integration-ui
        app.kubernetes.io/instance: open-xchange
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: nextcloud-integration-ui
        helm.sh/chart: nextcloud-integration-ui-1.2.0
        version: 1.2.0
    spec:
      affinity: {}
      containers:
      - image: registry.opencode.de/bmi/opendesk/components/supplier/open-xchange/images-mirror/nextcloud-integration-ui:1.2.0@sha256:3d0ef11196f7544a01539e6790e4402ad69e2a501312eb7c7bb128c6563d0a8d
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 15
          httpGet:
            path: /
            port: 8080
          periodSeconds: 10
        name: main
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 2
          httpGet:
            path: /
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 5
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 96Mi
          requests:
            cpu: 0.01
            memory: 32Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: false
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /tmp
          name: tmp
      imagePullSecrets: []
      nodeSelector: {}
      securityContext:
        runAsGroup: 1000
        runAsNonRoot: true
        runAsUser: 1000
      serviceAccountName: default
      tolerations: []
      volumes:
      - emptyDir: {}
        name: tmp
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: public-sector-ui
    app.kubernetes.io/instance: open-xchange
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: public-sector-ui
    helm.sh/chart: public-sector-ui-2.3.0
    version: 2.3.0
  name: open-xchange-public-sector-ui
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: open-xchange
      app.kubernetes.io/name: public-sector-ui
  template:
    metadata:
      annotations:
        commit.open-xchange.com/public-sector-ui: f63b081469eddede5f35c9d05eb2528f41d89d50
      labels:
        app: public-sector-ui
        app.kubernetes.io/instance: open-xchange
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: public-sector-ui
        helm.sh/chart: public-sector-ui-2.3.0
        version: 2.3.0
    spec:
      affinity: {}
      containers:
      - image: registry.opencode.de/bmi/opendesk/components/supplier/open-xchange/images-mirror/public-sector-ui:2.3.0@sha256:a557816ee55500ecc3b46b60f0440ea66c7f0d90e888ce3b0df8a9acdd72acbe
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 15
          httpGet:
            path: /
            port: 8080
          periodSeconds: 10
        name: main
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 2
          httpGet:
            path: /
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 5
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 96Mi
          requests:
            cpu: 0.01
            memory: 32Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /tmp
          name: tmp
      imagePullSecrets: []
      nodeSelector: {}
      securityContext:
        runAsGroup: 1000
        runAsNonRoot: true
        runAsUser: 1000
      serviceAccountName: default
      tolerations: []
      volumes:
      - emptyDir: {}
        name: tmp
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    intents.otterize.com/service-name: opendesk-nextcloud
  labels:
    app.kubernetes.io/instance: opendesk-nextcloud
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: aio
    helm.sh/chart: aio-3.4.0
  name: opendesk-nextcloud-aio
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: opendesk-nextcloud
      app.kubernetes.io/name: aio
  strategy:
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/configmap: e4d54b3371f275352d27c8cf89bb23b335fdb1485448f29ad3c1090e7d829bee
      labels:
        app.kubernetes.io/instance: opendesk-nextcloud
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: aio
        helm.sh/chart: aio-3.4.0
    spec:
      containers:
      - env:
        - name: FS_ENV_OVERWRITE_PROTOCOL
          value: https
        - name: FS_ENV_TRUSTED_PROXIES
          value: 10.0.0.0/8
        - name: FS_ENV_RUN_MODE
          value: runtime
        - name: FS_ENV_DBTYPE
          value: mysql
        - name: FS_ENV_DBHOST
          value: mariadb
        - name: FS_ENV_DBNAME
          value: nextcloud
        - name: FS_ENV_DBPORT
          value: '3306'
        - name: FS_ENV_DBUSER
          valueFrom:
            secretKeyRef:
              key: username
              name: opendesk-nextcloud-aio-database
        - name: FS_ENV_DBPASSWORD
          valueFrom:
            secretKeyRef:
              key: password
              name: opendesk-nextcloud-aio-database
        - name: FS_ENV_REDIS_HOST
          value: redis-headless
        - name: FS_ENV_REDIS_PORT
          value: '6379'
        - name: FS_ENV_REDIS_TIMEOUT
          value: '30'
        - name: FS_ENV_REDIS_DBINDEX
          value: '4'
        - name: FS_ENV_PHP_REDIS_DBINDEX
          value: '5'
        - name: FS_ENV_REDIS_USER
          valueFrom:
            secretKeyRef:
              key: username
              name: opendesk-nextcloud-aio-cache
        - name: FS_ENV_REDIS_PASSWORD
          valueFrom:
            secretKeyRef:
              key: password
              name: opendesk-nextcloud-aio-cache
        - name: FS_ENV_CREATE_OCDATA
          value: 'true'
        - name: FS_ENV_TRUSTED_DOMAINS
          value: files.apps.digilab.network
        image: registry.opencode.de/bmi/opendesk/components/platform-development/images/opendesk-nextcloud:2.2.3@sha256:b5e36b4922b50be96ecdd8628d8124880251da5b2e98cfa5b12cf1ef715d042f
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            httpHeaders:
            - name: Host
              value: localhost
            path: /health
            port: 8081
          initialDelaySeconds: 30
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 2
        name: aio
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 9000
          name: php
          protocol: TCP
        - containerPort: 8081
          name: status
          protocol: TCP
        readinessProbe:
          failureThreshold: 10
          httpGet:
            httpHeaders:
            - name: Host
              value: localhost
            path: /health
            port: 8081
          initialDelaySeconds: 1
          periodSeconds: 1
          successThreshold: 1
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 1Gi
          requests:
            cpu: 0.1
            memory: 512Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 101
          runAsNonRoot: true
          runAsUser: 101
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        startupProbe:
          failureThreshold: 10
          httpGet:
            httpHeaders:
            - name: Host
              value: localhost
            path: /health
            port: 8081
          initialDelaySeconds: 5
          periodSeconds: 5
          successThreshold: 1
          timeoutSeconds: 5
        volumeMounts:
        - mountPath: /var/www/html/config
          name: nextcloud-config
        - mountPath: /var/nextcloud/data
          name: nextcloud-data
        - mountPath: /tmp
          name: nextcloud-tmp
        - mountPath: /etc/nginx/conf.d
          name: nginx-config
        - mountPath: /var/cache/nginx/
          name: nginx-tmp
        - mountPath: /var/run/
          name: run
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: Always
      serviceAccountName: opendesk-nextcloud-aio
      volumes:
      - emptyDir: {}
        name: nextcloud-data
      - emptyDir: {}
        name: nextcloud-tmp
      - emptyDir: {}
        name: nginx-tmp
      - emptyDir: {}
        name: run
      - emptyDir:
          medium: Memory
          sizeLimit: 5Mi
        name: nextcloud-config
      - emptyDir:
          medium: Memory
          sizeLimit: 5Mi
        name: nginx-config
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: opendesk-nextcloud
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: exporter
    helm.sh/chart: exporter-3.4.0
  name: opendesk-nextcloud-exporter
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: opendesk-nextcloud
      app.kubernetes.io/name: exporter
  strategy:
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/configmap: fca71b7d9a252305f54271afad2ce84cd761807213e7520a09d9121789662355
      labels:
        app.kubernetes.io/instance: opendesk-nextcloud
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: exporter
        helm.sh/chart: exporter-3.4.0
    spec:
      containers:
      - env:
        - name: NEXTCLOUD_TIMEOUT
          value: 5s
        - name: NEXTCLOUD_TLS_SKIP_VERIFY
          value: 'false'
        - name: NEXTCLOUD_AUTH_TOKEN
          valueFrom:
            secretKeyRef:
              key: token
              name: opendesk-nextcloud-exporter
        - name: NEXTCLOUD_SERVER
          value: http://opendesk-nextcloud-apache2
        image: registry.opencode.de/bmi/opendesk/components/platform-development/images/opendesk-nextcloud-exporter:1.0.1@sha256:63e63c7420e37d3989fa0ffdbcf18a07b2a603ab9b2a849c2e7e44342dd82af0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          initialDelaySeconds: 30
          periodSeconds: 10
          successThreshold: 1
          tcpSocket:
            port: 9205
          timeoutSeconds: 2
        name: exporter
        ports:
        - containerPort: 9205
          name: metrics
          protocol: TCP
        readinessProbe:
          failureThreshold: 10
          initialDelaySeconds: 1
          periodSeconds: 1
          successThreshold: 1
          tcpSocket:
            port: 9205
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 128Mi
          requests:
            cpu: 0.1
            memory: 32Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 65532
          runAsNonRoot: true
          runAsUser: 65532
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        startupProbe:
          failureThreshold: 10
          initialDelaySeconds: 5
          periodSeconds: 5
          successThreshold: 1
          tcpSocket:
            port: 9205
          timeoutSeconds: 5
        volumeMounts: null
      securityContext:
        fsGroup: 65532
        fsGroupChangePolicy: Always
      serviceAccountName: opendesk-nextcloud-exporter
      volumes: null
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: collabora-online
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: collabora-online
    app.kubernetes.io/version: 24.04.7.2.1
    helm.sh/chart: collabora-online-1.1.21
  name: collabora
spec:
  minReadySeconds: 0
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: collabora-online
      app.kubernetes.io/name: collabora-online
      type: main
  strategy:
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
    type: RollingUpdate
  template:
    metadata:
      annotations:
        cluster-autoscaler.kubernetes.io/safe-to-evict: 'true'
        confighash: config-5bca441eae5a63d797c0ac2e45dee0c4
      labels:
        app.kubernetes.io/instance: collabora-online
        app.kubernetes.io/name: collabora-online
        type: main
    spec:
      containers:
      - env:
        - name: username
          valueFrom:
            secretKeyRef:
              key: username
              name: collabora
        - name: password
          valueFrom:
            secretKeyRef:
              key: password
              name: collabora
        envFrom:
        - configMapRef:
            name: collabora
        image: registry.opencode.de/bmi/opendesk/components/supplier/collabora/images/collabora-online-for-opendesk:24.04.7.2.1@sha256:5b00478f2c6c7372b2a67e68783d9b1a91265679bbd4afdc1416e50720d50ce6
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 4
          httpGet:
            path: /
            port: 9980
            scheme: HTTP
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 30
        name: collabora-online
        ports:
        - containerPort: 9980
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 2
          httpGet:
            path: /
            port: 9980
            scheme: HTTP
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 30
        resources:
          limits:
            cpu: 99
            memory: 4Gi
          requests:
            cpu: 0.5
            memory: 512Mi
        securityContext:
          allowPrivilegeEscalation: true
          capabilities:
            add:
            - CHOWN
            - FOWNER
            - SYS_CHROOT
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: false
          runAsGroup: 101
          runAsNonRoot: true
          runAsUser: 100
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        startupProbe:
          failureThreshold: 30
          httpGet:
            path: /
            port: 9980
            scheme: HTTP
          periodSeconds: 3
        volumeMounts:
        - mountPath: /tmp
          name: tmp
      securityContext:
        fsGroup: 100
      serviceAccountName: collabora
      terminationGracePeriodSeconds: 60
      volumes:
      - emptyDir: {}
        name: tmp
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: cryptpad
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: cryptpad
    helm.sh/chart: cryptpad-0.0.20
  name: cryptpad
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: cryptpad
      app.kubernetes.io/name: cryptpad
  template:
    metadata:
      annotations:
        checksum/configmap: f6e9d6850871b4d40640ff44450e8a1b6e58fcc1bda2a122ab2111ba4e221be8
      labels:
        app.kubernetes.io/instance: cryptpad
        app.kubernetes.io/name: cryptpad
    spec:
      containers:
      - env:
        - name: CPAD_MAIN_DOMAIN
          value: https://pad.apps.digilab.network
        - name: CPAD_SANDBOX_DOMAIN
          value: https://pad.apps.digilab.network
        - name: CPAD_CONF
          value: /cryptpad/config/config.js
        image: registry.opencode.de/bmi/opendesk/components/supplier/xwiki/images-mirror/cryptpad:opendesk-20231222@sha256:f4d20d5c38c87b11ed1a1b46ef6a3633d32c6758ebdff8556458f040318fa5e2
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 5
          httpGet:
            path: /
            port: 3000
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: cryptpad
        ports:
        - containerPort: 3000
          name: http
          protocol: TCP
        - containerPort: 3003
          name: ws
          protocol: TCP
        readinessProbe:
          failureThreshold: 5
          httpGet:
            path: /
            port: 3000
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources:
          limits:
            cpu: 99
            memory: 2Gi
          requests:
            cpu: 0.1
            memory: 512Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: false
          runAsGroup: 4001
          runAsNonRoot: true
          runAsUser: 4001
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        startupProbe:
          failureThreshold: 5
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          tcpSocket:
            port: 3000
          timeoutSeconds: 1
        volumeMounts:
        - mountPath: /cryptpad/blob
          name: cryptpad-blob
        - mountPath: /cryptpad/block
          name: cryptpad-block
        - mountPath: /cryptpad/data
          name: cryptpad-data
        - mountPath: /cryptpad/datastore
          name: cryptpad-datastore
        - mountPath: /cryptpad/config/config.js
          name: configmaps
          subPath: config.js
        - mountPath: /cryptpad/customize/application_config.js
          name: configmaps
          subPath: application_config.js
      initContainers:
      - args:
        - "FILE=/cryptpad/data/decrees/decree.ndjson\nmkdir -p /cryptpad/data/decrees\n\
          VALUE='[\"ENABLE_EMBEDDING\", [true], \"\", 0]'\nif  [ -f $FILE ] && [ $(grep\
          \ -c \"ENABLE_EMBEDDING\" $FILE) -gt 0 ]\nthen\n  sed -i \"s|.*ENABLE_EMBEDDING.*|$VALUE|g\"\
          \ \"$FILE\"\nelse\n  echo \"$VALUE\" >> \"$FILE\"\nfi\n"
        command:
        - /bin/sh
        - -c
        image: registry.opencode.de/bmi/opendesk/components/supplier/xwiki/images-mirror/cryptpad:opendesk-20231222@sha256:f4d20d5c38c87b11ed1a1b46ef6a3633d32c6758ebdff8556458f040318fa5e2
        imagePullPolicy: IfNotPresent
        name: init-cryptpad
        resources:
          limits:
            cpu: 99
            memory: 2Gi
          requests:
            cpu: 0.1
            memory: 512Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: false
          runAsGroup: 4001
          runAsNonRoot: true
          runAsUser: 4001
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /cryptpad/data
          name: cryptpad-data
      securityContext:
        fsGroup: 4001
      serviceAccountName: cryptpad
      volumes:
      - configMap:
          name: cryptpad
        name: configmaps
      - emptyDir: {}
        name: cryptpad-blob
      - emptyDir: {}
        name: cryptpad-block
      - emptyDir: {}
        name: cryptpad-data
      - emptyDir: {}
        name: cryptpad-datastore
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/component: jibri
    app.kubernetes.io/instance: jitsi
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: jitsi
    app.kubernetes.io/version: stable-9646
    helm.sh/chart: jitsi-1.4.1
  name: jitsi-jibri
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: jibri
      app.kubernetes.io/instance: jitsi
      app.kubernetes.io/name: jitsi
  template:
    metadata:
      annotations:
        checksum/config: b67ad2da5d1ac1a7b5b26a8621ebfad80757f8eb67a015a7703fcdc449ce0e10
        checksum/secret: 0fc5d3392d6a5569ab027e41ca89ff53433f2dfcb81edfe4d5c04fb7111c1f9f
      labels:
        app.kubernetes.io/component: jibri
        app.kubernetes.io/instance: jitsi
        app.kubernetes.io/name: jitsi
    spec:
      containers:
      - envFrom:
        - secretRef:
            name: jitsi-prosody-jibri
        - configMapRef:
            name: jitsi-prosody-common
        - configMapRef:
            name: jitsi-jibri
        image: registry.opencode.de/bmi/opendesk/components/supplier/nordeck/images-mirror/jibri:stable-9779@sha256:7a0dfa397e7c6c03eb1dc2b49d94f0dc2d6fc44fe85761f67a45ea0e34056b3e
        imagePullPolicy: IfNotPresent
        livenessProbe:
          exec:
            command:
            - /bin/bash
            - -c
            - curl -sq localhost:2222/jibri/api/v1.0/health | jq '"\(.status.health.healthStatus)
              \(.status.busyStatus)"' | grep -qP 'HEALTHY (IDLE|BUSY)'
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 5
          timeoutSeconds: 3
        name: jitsi
        ports:
        - containerPort: 3333
          name: http-internal
        - containerPort: 2222
          name: http-api
        readinessProbe:
          exec:
            command:
            - /bin/bash
            - -c
            - curl -sq localhost:2222/jibri/api/v1.0/health | jq '"\(.status.health.healthStatus)
              \(.status.busyStatus)"' | grep -qP 'HEALTHY (IDLE|BUSY)'
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 5
          timeoutSeconds: 3
        resources:
          limits:
            cpu: 99
            memory: 3Gi
          requests:
            cpu: 0.1
            memory: 384Mi
        securityContext:
          capabilities:
            add:
            - SYS_ADMIN
        volumeMounts:
        - mountPath: /config
          name: config
        - mountPath: /data
          name: jibri-data
        - mountPath: /dev/shm
          name: dev-shm
      serviceAccountName: jitsi
      volumes:
      - emptyDir: {}
        name: config
      - configMap:
          defaultMode: 493
          items:
          - key: 10-config
            path: 10-config
          name: jitsi-jibri-cont-inits
        name: custom-cont-inits
      - configMap:
          items:
          - key: jibri.conf
            path: jibri.conf
          - key: logging.properties
            path: logging.properties
          - key: autoscaler-sidecar.config
            path: autoscaler-sidecar.config
          - key: xorg-video-dummy.conf
            path: xorg-video-dummy.conf
          name: jitsi-jibri-defaults
        name: custom-defaults
      - emptyDir: {}
        name: jibri-data
      - emptyDir:
          medium: Memory
          sizeLimit: 2Gi
        name: dev-shm
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/component: jicofo
    app.kubernetes.io/instance: jitsi
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: jitsi
    app.kubernetes.io/version: stable-9646
    helm.sh/chart: jitsi-1.4.1
  name: jitsi-jicofo
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: jicofo
      app.kubernetes.io/instance: jitsi
      app.kubernetes.io/name: jitsi
  template:
    metadata:
      annotations:
        checksum/config: fbd62f00b5ee90a6f37535b1a60e78f2cf0cd02f6927989beea26eae89c06674
        checksum/secret: 4ca9c4f43f428978a161382c5267f97881c143876508a426663e3c0ea519fe2a
      labels:
        app.kubernetes.io/component: jicofo
        app.kubernetes.io/instance: jitsi
        app.kubernetes.io/name: jitsi
    spec:
      containers:
      - envFrom:
        - secretRef:
            name: jitsi-prosody-jicofo
        - configMapRef:
            name: jitsi-prosody-common
        - configMapRef:
            name: jitsi-jicofo
        image: registry.opencode.de/bmi/opendesk/components/supplier/nordeck/images-mirror/jicofo:stable-9779@sha256:6b00d53a899e01058a99fa71a3238442e18c43bc62d4212b6647b4f7aa67aae1
        imagePullPolicy: IfNotPresent
        livenessProbe:
          tcpSocket:
            port: 8888
        name: jitsi
        ports:
        - containerPort: 80
          name: http
          protocol: TCP
        readinessProbe:
          tcpSocket:
            port: 8888
        resources:
          limits:
            cpu: 99
            memory: 3584Mi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities: {}
          privileged: false
          readOnlyRootFilesystem: false
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /config
          name: config
      securityContext: {}
      serviceAccountName: jitsi
      volumes:
      - emptyDir: {}
        name: config
      - configMap:
          defaultMode: 493
          items:
          - key: 10-config
            path: 10-config
          name: jitsi-jicofo-cont-inits
        name: custom-cont-inits
      - configMap:
          items:
          - key: jicofo.conf
            path: jicofo.conf
          - key: logging.properties
            path: logging.properties
          name: jitsi-jicofo-defaults
        name: custom-defaults
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/component: jvb
    app.kubernetes.io/instance: jitsi
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: jitsi
    app.kubernetes.io/version: stable-9646
    helm.sh/chart: jitsi-1.4.1
  name: jitsi-jvb
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: jvb
      app.kubernetes.io/instance: jitsi
      app.kubernetes.io/name: jitsi
  template:
    metadata:
      annotations:
        checksum/config: a122e93ceed1313beded34f7278150cdb353d6086a34f4b2e46523d480af03f9
        checksum/secret: 5f12c28b3b7f917106b0b5c32a0a5d253bb017612af763a2cf6b270ac3d411b6
      labels:
        app.kubernetes.io/component: jvb
        app.kubernetes.io/instance: jitsi
        app.kubernetes.io/name: jitsi
    spec:
      containers:
      - env:
        - name: DOCKER_HOST_ADDRESS
          value: 0.0.0.0
        - name: JVB_ADVERTISE_IPS
          value: 0.0.0.0
        - name: JVB_WS_SERVER_ID
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        envFrom:
        - secretRef:
            name: jitsi-prosody-jvb
        - configMapRef:
            name: jitsi-prosody-common
        - configMapRef:
            name: jitsi-jvb
        image: registry.opencode.de/bmi/opendesk/components/supplier/nordeck/images-mirror/jvb:stable-9779@sha256:126719d4bd6fc3a85b61e786936a561a41527223b7b6a9c6204df41b1af48a50
        imagePullPolicy: IfNotPresent
        livenessProbe:
          httpGet:
            path: /about/health
            port: 8080
        name: jitsi
        ports:
        - containerPort: 10000
          name: rtp-udp
          protocol: UDP
        - containerPort: 9090
          name: colibri-ws-tcp
          protocol: TCP
        readinessProbe:
          httpGet:
            path: /about/health
            port: 8080
        resources:
          limits:
            cpu: 99
            memory: 3584Mi
          requests:
            cpu: 0.1
            memory: 384Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities: {}
          privileged: false
          readOnlyRootFilesystem: false
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
      securityContext: {}
      serviceAccountName: jitsi
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/component: web
    app.kubernetes.io/instance: jitsi
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: jitsi
    app.kubernetes.io/version: stable-9646
    helm.sh/chart: jitsi-1.4.1
  name: jitsi-web
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: web
      app.kubernetes.io/instance: jitsi
      app.kubernetes.io/name: jitsi
  template:
    metadata:
      annotations:
        checksum/config: 8c27b02deaa54a30d1a7afd0c755333b24fad166f43b16aabd13cde2e8d4b4c6
      labels:
        app.kubernetes.io/component: web
        app.kubernetes.io/instance: jitsi
        app.kubernetes.io/name: jitsi
    spec:
      containers:
      - envFrom:
        - configMapRef:
            name: jitsi-web
        - configMapRef:
            name: jitsi-prosody-common
        image: registry.opencode.de/bmi/opendesk/components/supplier/nordeck/images-mirror/web:stable-9779@sha256:77f9cb45bb8c1053002b1ce8987ac26aa1d3724e79b23b0403ca0e92469b7d14
        imagePullPolicy: IfNotPresent
        livenessProbe:
          httpGet:
            path: /
            port: 80
        name: jitsi
        ports:
        - containerPort: 80
          name: http
          protocol: TCP
        - containerPort: 443
          name: https
          protocol: TCP
        readinessProbe:
          httpGet:
            path: /
            port: 80
        resources:
          limits:
            cpu: 99
            memory: 512Mi
          requests:
            cpu: 0.1
            memory: 32Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities: {}
          privileged: false
          readOnlyRootFilesystem: false
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /config
          name: config
        - mountPath: /config/custom-config.js
          name: jitsi-meet-files
          subPath: custom-config.js
        - mountPath: /config/custom-interface_config.js
          name: jitsi-meet-files
          subPath: custom-interface_config.js
        - mountPath: /defaults/meet.conf
          name: jitsi-meet-files
          subPath: meet.oidc.conf
        - mountPath: /usr/share/jitsi-meet/body.html
          name: jitsi-meet-files
          subPath: body.html
        - mountPath: /usr/share/jitsi-meet/plugin.head.html
          name: jitsi-meet-files
          subPath: plugin.head.html
        - mountPath: /usr/share/jitsi-meet/images/favicon.svg
          name: jitsi-meet-files
          subPath: favicon.svg
        - mountPath: /usr/share/jitsi-meet/images/watermark.svg
          name: jitsi-meet-files
          subPath: watermark.svg
        - mountPath: /usr/share/jitsi-meet/images/welcome-background.jpg
          name: jitsi-meet-binaries
          subPath: welcome-background.jpg
        - mountPath: /usr/share/jitsi-meet/static/branding.json
          name: jitsi-meet-files
          subPath: branding.json
        - mountPath: /usr/share/jitsi-meet/static/lang-overwritten-de.json
          name: jitsi-meet-files
          subPath: lang-overwritten-de.json
        - mountPath: /usr/share/jitsi-meet/static/lang-overwritten-en.json
          name: jitsi-meet-files
          subPath: lang-overwritten-en.json
        - mountPath: /usr/share/jitsi-meet/static/oidc-adapter.html
          name: jitsi-meet-files
          subPath: oidc-adapter.html
        - mountPath: /usr/share/jitsi-meet/static/oidc-redirect.html
          name: jitsi-meet-files
          subPath: oidc-redirect.html
        - mountPath: /usr/share/jitsi-meet/static/url-ics
          name: jitsi-meet-files
          subPath: url-ics
        - mountPath: /usr/share/jitsi-meet/static/url-portal
          name: jitsi-meet-files
          subPath: url-portal
      securityContext: {}
      serviceAccountName: jitsi
      volumes:
      - emptyDir: {}
        name: config
      - configMap:
          defaultMode: 493
          items:
          - key: 10-config
            path: 10-config
          name: jitsi-web-init
        name: custom-init
      - configMap:
          items:
          - key: custom-config.js
            path: custom-config.js
          - key: custom-interface_config.js
            path: custom-interface_config.js
          - key: default
            path: default
          - key: ffdhe2048.txt
            path: ffdhe2048.txt
          - key: interface_config.js
            path: interface_config.js
          - key: meet.conf
            path: meet.conf
          - key: nginx.conf
            path: nginx.conf
          - key: settings-config.js
            path: settings-config.js
          - key: ssl.conf
            path: ssl.conf
          - key: system-config.js
            path: system-config.js
          name: jitsi-web-conffiles
        name: custom-conffiles
      - configMap:
          items:
          - key: body.html
            path: body.html
          - key: branding.json
            path: branding.json
          - key: custom-config.js
            path: custom-config.js
          - key: custom-interface_config.js
            path: custom-interface_config.js
          - key: favicon.svg
            path: favicon.svg
          - key: lang-overwritten-de.json
            path: lang-overwritten-de.json
          - key: lang-overwritten-en.json
            path: lang-overwritten-en.json
          - key: meet.oidc.conf
            path: meet.oidc.conf
          - key: oidc-adapter.html
            path: oidc-adapter.html
          - key: oidc-redirect.html
            path: oidc-redirect.html
          - key: plugin.head.html
            path: plugin.head.html
          - key: url-ics
            path: url-ics
          - key: url-portal
            path: url-portal
          - key: watermark.svg
            path: watermark.svg
          name: jitsi-meet-files
        name: jitsi-meet-files
      - configMap:
          items:
          - key: welcome-background.jpg
            path: welcome-background.jpg
          name: jitsi-meet-binaries
        name: jitsi-meet-binaries
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: jitsi
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: opendesk-jitsi
    helm.sh/chart: opendesk-jitsi-2.0.3
  name: opendesk-jitsi-keycloak-adapter
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: jitsi
      app.kubernetes.io/name: opendesk-jitsi
  strategy:
    type: RollingUpdate
  template:
    metadata:
      annotations: null
      labels:
        app.kubernetes.io/instance: jitsi
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: opendesk-jitsi
        helm.sh/chart: opendesk-jitsi-2.0.3
    spec:
      containers:
      - env:
        - name: KEYCLOAK_ORIGIN
          value: https://id.apps.digilab.network
        - name: KEYCLOAK_REALM
          value: opendesk
        - name: KEYCLOAK_CLIENT_ID
          value: opendesk-jitsi
        - name: JWT_APP_ID
          value: meet.apps.digilab.network
        - name: JWT_APP_SECRET
          valueFrom:
            secretKeyRef:
              key: jwtAppSecret
              name: jitsi-opendesk-jitsi-keycloak-adapter
        - name: JWT_ALG
          value: HS256
        - name: JWT_HASH
          value: SHA-256
        - name: JWT_EXP_SECOND
          value: '3600'
        - name: HOSTNAME
          value: 0.0.0.0
        - name: ALLOW_UNSECURE_CERT
          value: 'false'
        image: registry.opencode.de/bmi/opendesk/components/supplier/nordeck/images-mirror/jitsi-keycloak-adapter:v20241023@sha256:2391799c5168222f0e3ebb94d7c3cb3bcea6f075399458197f0c1bbbb8f293fe
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 5
          httpGet:
            path: /health
            port: 9000
          initialDelaySeconds: 5
          periodSeconds: 3
          successThreshold: 1
          timeoutSeconds: 1
        name: keycloak
        ports:
        - containerPort: 9000
          name: adapter
          protocol: TCP
        readinessProbe:
          failureThreshold: 15
          httpGet:
            path: /health
            port: 9000
          initialDelaySeconds: 5
          periodSeconds: 5
          successThreshold: 1
          timeoutSeconds: 1
        resources:
          limits:
            cpu: 99
            memory: 128Mi
          requests:
            cpu: 10m
            memory: 48Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1993
          runAsNonRoot: true
          runAsUser: 1993
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /app/context.ts
          name: jitsi-keycloak-adapter-files
          subPath: context.ts
        - mountPath: /tmp
          name: tmp
      serviceAccountName: jitsi-opendesk-jitsi
      volumes:
      - configMap:
          items:
          - key: context.ts
            path: context.ts
          name: jitsi-keycloak-adapter-files
        name: jitsi-keycloak-adapter-files
      - emptyDir: {}
        name: tmp
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/component: clamd
    app.kubernetes.io/instance: opendesk-element
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: opendesk-element
    helm.sh/chart: opendesk-element-3.4.1
  name: opendesk-element
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: opendesk-element
      app.kubernetes.io/name: opendesk-element
  strategy:
    rollingUpdate:
      maxSurge: 2
      maxUnavailable: 1
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/configmap: 5ef5f215851b30fcef57ecc38e8efabc414ad8965b304c64be5654f8cb982278
      labels:
        app.kubernetes.io/instance: opendesk-element
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: opendesk-element
        helm.sh/chart: opendesk-element-3.4.1
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: app.kubernetes.io/instance
                operator: In
                values:
                - opendesk-element
            topologyKey: kubernetes.io/hostname
      containers:
      - env: null
        image: registry.opencode.de/bmi/opendesk/components/supplier/nordeck/images/opendesk-element-web:1.11.2@sha256:faf57be74ff715e0f7c833a977f9f7b974ed3230d5d4e30733be7ed01b295a4c
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /health
            port: element
            scheme: HTTP
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: element
        ports:
        - containerPort: 8080
          name: element
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /health
            port: element
            scheme: HTTP
          initialDelaySeconds: 1
          periodSeconds: 1
          successThreshold: 1
          timeoutSeconds: 1
        resources:
          limits:
            cpu: 99
            memory: 256Mi
          requests:
            cpu: 0.1
            memory: 32Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 101
          runAsNonRoot: true
          runAsUser: 101
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        startupProbe:
          failureThreshold: 3
          httpGet:
            path: /health
            port: element
            scheme: HTTP
          initialDelaySeconds: 2
          periodSeconds: 2
          successThreshold: 1
          timeoutSeconds: 1
        volumeMounts:
        - mountPath: /app/config.json
          name: config
          readOnly: true
          subPath: config.json
        - mountPath: /app/custom-home.html
          name: config
          readOnly: true
          subPath: custom-home.html
        - mountPath: /app/custom-translations.json
          name: config
          readOnly: true
          subPath: custom-translations.json
        - mountPath: /etc/nginx/nginx.conf
          name: nginx-config
          readOnly: true
          subPath: nginx.conf
        - mountPath: /tmp
          name: tmp
      securityContext:
        fsGroup: 101
      serviceAccountName: opendesk-element
      terminationGracePeriodSeconds: 30
      volumes:
      - configMap:
          defaultMode: 420
          name: opendesk-element
        name: config
      - configMap:
          defaultMode: 420
          name: opendesk-element-nginx
        name: nginx-config
      - emptyDir:
          medium: Memory
          sizeLimit: 50Mi
        name: tmp
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/component: clamd
    app.kubernetes.io/instance: opendesk-well-known
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: opendesk-well-known
    helm.sh/chart: opendesk-well-known-3.4.1
  name: opendesk-well-known
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: opendesk-well-known
      app.kubernetes.io/name: opendesk-well-known
  strategy:
    rollingUpdate:
      maxSurge: 2
      maxUnavailable: 1
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/configmap: 652cd68232000786ffb477bee6a6bf456e41aa89bc318a1a6348f3ac9e15a155
      labels:
        app.kubernetes.io/instance: opendesk-well-known
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: opendesk-well-known
        helm.sh/chart: opendesk-well-known-3.4.1
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: app.kubernetes.io/instance
                operator: In
                values:
                - opendesk-well-known
            topologyKey: kubernetes.io/hostname
      containers:
      - env: null
        image: registry-1.docker.io/library/nginx:1.27.0-bookworm@sha256:1445eb9c6dc5e9619346c836ef6fbd6a95092e4663f27dcfce116f051cdbd232
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /.well-known/matrix/server
            port: well-known
            scheme: HTTP
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 5
        name: well-known
        ports:
        - containerPort: 8080
          name: well-known
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /.well-known/matrix/server
            port: well-known
            scheme: HTTP
          initialDelaySeconds: 20
          periodSeconds: 20
          successThreshold: 1
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 256Mi
          requests:
            cpu: 0.1
            memory: 32Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 101
          runAsNonRoot: true
          runAsUser: 101
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /usr/share/nginx/html/.well-known/matrix
          name: config
          readOnly: true
        - mountPath: /etc/nginx/nginx.conf
          name: nginx-config
          readOnly: true
          subPath: nginx.conf
        - mountPath: /tmp
          name: tmp
      securityContext:
        fsGroup: 101
      serviceAccountName: opendesk-well-known
      terminationGracePeriodSeconds: 30
      volumes:
      - configMap:
          defaultMode: 420
          name: opendesk-well-known
        name: config
      - configMap:
          defaultMode: 420
          name: opendesk-well-known-nginx
        name: nginx-config
      - emptyDir:
          medium: Memory
          sizeLimit: 50Mi
        name: tmp
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: opendesk-synapse-web
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: opendesk-synapse-web
    helm.sh/chart: opendesk-synapse-web-3.4.1
  name: opendesk-synapse-web
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: opendesk-synapse-web
      app.kubernetes.io/name: opendesk-synapse-web
  strategy:
    rollingUpdate:
      maxSurge: 2
      maxUnavailable: 1
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/configmap: 7d3a93f721743131a4da2eba9b43a560ae5e7ed9caf2bc61e43aaf5f470ceb1f
      labels:
        app.kubernetes.io/instance: opendesk-synapse-web
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: opendesk-synapse-web
        helm.sh/chart: opendesk-synapse-web-3.4.1
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: app.kubernetes.io/instance
                operator: In
                values:
                - opendesk-synapse-web
            topologyKey: kubernetes.io/hostname
      containers:
      - env: null
        image: registry-1.docker.io/rapidfort/haproxy-official:2.6.15-bullseye@sha256:47b6ca4074347788cb414fbf3db35d0c51e9e47af33be46457f95c750540887c
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /haproxy_test
            port: web
            scheme: HTTP
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: haproxy
        ports:
        - containerPort: 8008
          name: web
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /haproxy_test
            port: web
            scheme: HTTP
          initialDelaySeconds: 1
          periodSeconds: 1
          successThreshold: 1
          timeoutSeconds: 1
        resources:
          limits:
            cpu: 99
            memory: 256Mi
          requests:
            cpu: 0.1
            memory: 64Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 101
          runAsNonRoot: true
          runAsUser: 101
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /usr/local/etc/haproxy
          name: config
          readOnly: true
      securityContext:
        fsGroup: 101
      serviceAccountName: opendesk-synapse-web
      terminationGracePeriodSeconds: 30
      volumes:
      - configMap:
          defaultMode: 420
          name: opendesk-synapse-web
        name: config
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: opendesk-matrix-user-verification-service
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: opendesk-matrix-user-verification-service
    helm.sh/chart: opendesk-matrix-user-verification-service-3.4.0
  name: opendesk-matrix-user-verification-service
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: opendesk-matrix-user-verification-service
      app.kubernetes.io/name: opendesk-matrix-user-verification-service
  strategy:
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/configmap: 069e564416956e1137aea4921885cf9258f54b70e4d0305c48efd453100bb959
      labels:
        app.kubernetes.io/instance: opendesk-matrix-user-verification-service
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: opendesk-matrix-user-verification-service
        helm.sh/chart: opendesk-matrix-user-verification-service-3.4.0
    spec:
      containers:
      - env:
        - name: UVS_HOMESERVER_URL
          value: https://matrix.apps.digilab.network
        - name: UVS_ACCESS_TOKEN
          valueFrom:
            secretKeyRef:
              key: access_token
              name: opendesk-matrix-user-verification-service-account
        - name: UVS_DISABLE_IP_BLACKLIST
          value: 'true'
        image: registry.opencode.de/bmi/opendesk/components/supplier/element/images-mirror/matrix-user-verification-service:v3.0.0@sha256:25e685d595785e2a72e75a525dac78cf8c782445454f8ac090d3702431c38008
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 10
          httpGet:
            path: /health
            port: http
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          timeoutSeconds: 5
        name: uvs
        ports:
        - containerPort: 3000
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 10
          httpGet:
            path: /health
            port: http
          initialDelaySeconds: 15
          periodSeconds: 15
          successThreshold: 1
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 256Mi
          requests:
            cpu: 0.1
            memory: 128Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: false
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts: null
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: Always
      serviceAccountName: opendesk-matrix-user-verification-service
      volumes: null
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: matrix-neoboard-widget
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: matrix-neoboard-widget
    helm.sh/chart: matrix-neoboard-widget-3.5.0
  name: matrix-neoboard-widget
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: matrix-neoboard-widget
      app.kubernetes.io/name: matrix-neoboard-widget
  strategy:
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/configmap: 0ca01953c011830f6251e7a760c37ecdf3c0ea4eb5dfbef1a261c2e1917798a2
      labels:
        app.kubernetes.io/instance: matrix-neoboard-widget
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: matrix-neoboard-widget
        helm.sh/chart: matrix-neoboard-widget-3.5.0
    spec:
      containers:
      - env:
        - name: REACT_APP_HOME_SERVER_URL
          value: https://matrix.apps.digilab.network
        - name: REACT_APP_PRIMARY_COLOR
          value: '#571EFA'
        image: registry.opencode.de/bmi/opendesk/components/supplier/nordeck/images-mirror/matrix-neoboard-widget:1.20.0@sha256:e72bca018af1c0087587f6bcd1748c820ff520c8cf2a042b9b58354cdc878345
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 10
          httpGet:
            path: /
            port: http
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          timeoutSeconds: 5
        name: widget
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 10
          httpGet:
            path: /
            port: http
          initialDelaySeconds: 15
          periodSeconds: 15
          successThreshold: 1
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 128Mi
          requests:
            cpu: 0.1
            memory: 48Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 101
          runAsNonRoot: true
          runAsUser: 101
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /var/cache/nginx
          name: cache
        - mountPath: /tmp
          name: tmp
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: Always
      serviceAccountName: matrix-neoboard-widget
      volumes:
      - emptyDir:
          medium: Memory
          sizeLimit: 50Mi
        name: cache
      - emptyDir:
          medium: Memory
          sizeLimit: 50Mi
        name: tmp
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: matrix-neochoice-widget
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: matrix-neochoice-widget
    helm.sh/chart: matrix-neochoice-widget-3.5.0
  name: matrix-neochoice-widget
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: matrix-neochoice-widget
      app.kubernetes.io/name: matrix-neochoice-widget
  strategy:
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/configmap: e1ff68244925e6b735edbb8c45c5fe9776ab3f51b54968228578c2228a1f0513
      labels:
        app.kubernetes.io/instance: matrix-neochoice-widget
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: matrix-neochoice-widget
        helm.sh/chart: matrix-neochoice-widget-3.5.0
    spec:
      containers:
      - env:
        - name: REACT_APP_HOME_SERVER_URL
          value: https://matrix.apps.digilab.network
        - name: REACT_APP_POLL_DESCRIPTION_REQUIRED
          value: 'true'
        - name: REACT_APP_IGNORE_USER_IDS
          value: '@meetings-bot:apps.digilab.network'
        - name: REACT_APP_PRIMARY_COLOR
          value: '#571EFA'
        image: registry.opencode.de/bmi/opendesk/components/supplier/nordeck/images-mirror/matrix-poll-widget:1.4.0@sha256:216cb88aaa47449a15af9a531d60eee593cb1923c4e8fcc67c119982972911e5
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 10
          httpGet:
            path: /
            port: http
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          timeoutSeconds: 5
        name: widget
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 10
          httpGet:
            path: /
            port: http
          initialDelaySeconds: 15
          periodSeconds: 15
          successThreshold: 1
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 256Mi
          requests:
            cpu: 0.1
            memory: 48Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 101
          runAsNonRoot: true
          runAsUser: 101
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /var/cache/nginx
          name: cache
        - mountPath: /tmp
          name: tmp
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: Always
      serviceAccountName: matrix-neochoice-widget
      volumes:
      - emptyDir:
          medium: Memory
          sizeLimit: 50Mi
        name: cache
      - emptyDir:
          medium: Memory
          sizeLimit: 50Mi
        name: tmp
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: matrix-neodatefix-widget
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: matrix-neodatefix-widget
    helm.sh/chart: matrix-neodatefix-widget-3.5.0
  name: matrix-neodatefix-widget
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: matrix-neodatefix-widget
      app.kubernetes.io/name: matrix-neodatefix-widget
  strategy:
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/configmap: bb3a65d460fb1516ab1d569a3662692d757f07146df5b095e723218fbc08be00
      labels:
        app.kubernetes.io/instance: matrix-neodatefix-widget
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: matrix-neodatefix-widget
        helm.sh/chart: matrix-neodatefix-widget-3.5.0
    spec:
      containers:
      - env:
        - name: REACT_APP_HOME_SERVER_URL
          value: https://matrix.apps.digilab.network
        - name: REACT_APP_API_BASE_URL
          value: https://matrix-neodatefix-bot.apps.digilab.network
        - name: REACT_APP_BOT_USER_ID
          value: '@meetings-bot:apps.digilab.network'
        - name: REACT_APP_DISPLAY_ALL_MEETINGS
          value: 'true'
        - name: REACT_APP_PRIMARY_COLOR
          value: '#571EFA'
        image: registry.opencode.de/bmi/opendesk/components/supplier/nordeck/images-mirror/matrix-meetings-widget:1.6.1@sha256:70bebd9293a977124a5da955e1a520381129d476d6414a083093c1b48a55dadd
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 10
          httpGet:
            path: /
            port: http
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          timeoutSeconds: 5
        name: widget
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 10
          httpGet:
            path: /
            port: http
          initialDelaySeconds: 15
          periodSeconds: 15
          successThreshold: 1
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 256Mi
          requests:
            cpu: 0.1
            memory: 48Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 101
          runAsNonRoot: true
          runAsUser: 101
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /var/cache/nginx
          name: cache
        - mountPath: /tmp
          name: tmp
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: Always
      serviceAccountName: matrix-neodatefix-widget
      volumes:
      - emptyDir:
          medium: Memory
          sizeLimit: 50Mi
        name: cache
      - emptyDir:
          medium: Memory
          sizeLimit: 50Mi
        name: tmp
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: matrix-neodatefix-bot
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: matrix-neodatefix-bot
    helm.sh/chart: matrix-neodatefix-bot-3.5.0
  name: matrix-neodatefix-bot
  namespace: tn-openbsw-opendesk
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: matrix-neodatefix-bot
      app.kubernetes.io/name: matrix-neodatefix-bot
  strategy:
    type: Recreate
  template:
    metadata:
      annotations:
        checksum/configmap: 9a8361282857b060f555bbf9da44e08aefee6606339102e07495503bf79e36ef
      labels:
        app.kubernetes.io/instance: matrix-neodatefix-bot
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: matrix-neodatefix-bot
        helm.sh/chart: matrix-neodatefix-bot-3.5.0
    spec:
      containers:
      - env:
        - name: LOG_LEVEL
          value: info
        - name: ENABLE_PRIVATE_ROOM_ERROR_SENDING
          value: 'false'
        - name: STORAGE_FILE_DATA_PATH
          value: /app/storage
        - name: ENABLE_CRYPTO
          value: 'false'
        - name: HOMESERVER_URL
          value: https://matrix.apps.digilab.network
        - name: MEETINGWIDGET_URL
          value: https://matrix-neodatefix-widget.apps.digilab.network/#/?theme=$org.matrix.msc2873.client_theme&matrix_user_id=$matrix_user_id&matrix_display_name=$matrix_display_name&matrix_avatar_url=$matrix_avatar_url&matrix_room_id=$matrix_room_id&matrix_client_id=$org.matrix.msc2873.client_id&matrix_client_language=$org.matrix.msc2873.client_language&matrix_device_id=$org.matrix.msc3819.matrix_device_id&matrix_base_url=$org.matrix.msc4039.matrix_base_url
        - name: MEETINGWIDGET_COCKPIT_URL
          value: https://matrix-neodatefix-widget.apps.digilab.network/cockpit/#/?theme=$org.matrix.msc2873.client_theme&matrix_user_id=$matrix_user_id&matrix_display_name=$matrix_display_name&matrix_avatar_url=$matrix_avatar_url&matrix_room_id=$matrix_room_id&matrix_client_id=$org.matrix.msc2873.client_id&matrix_client_language=$org.matrix.msc2873.client_language&matrix_device_id=$org.matrix.msc3819.matrix_device_id&matrix_base_url=$org.matrix.msc4039.matrix_base_url
        - name: BREAKOUT_SESSION_WIDGET_URL
          value: https://matrix-neodatefix-widget.apps.digilab.network/#/?theme=$org.matrix.msc2873.client_theme&matrix_user_id=$matrix_user_id&matrix_display_name=$matrix_display_name&matrix_avatar_url=$matrix_avatar_url&matrix_room_id=$matrix_room_id&matrix_client_id=$org.matrix.msc2873.client_id&matrix_client_language=$org.matrix.msc2873.client_language&matrix_device_id=$org.matrix.msc3819.matrix_device_id&matrix_base_url=$org.matrix.msc4039.matrix_base_url
        - name: MATRIX_LINK_SHARE
          value: https://chat.apps.digilab.network/#/room/
        - name: MEETINGWIDGET_NAME
          value: Terminplaner
        - name: MEETINGWIDGET_COCKPIT_NAME
          value: Meeting Steuerung
        - name: BREAKOUT_SESSION_WIDGET_NAME
          value: Breakoutsessions
        - name: CALENDAR_ROOM_NAME
          value: Terminplaner
        - name: BOT_DISPLAYNAME
          value: Meetings Bot
        - name: OPEN_XCHANGE_MEETING_URL_TEMPLATE
          value: https://webmail.apps.digilab.network/appsuite/#app=io.ox/calendar&id={{id}}&folder={{folder}}
        - name: ENABLE_GUEST_USER_POWER_LEVEL_CHANGE
          value: 'true'
        - name: ACCESS_TOKEN
          valueFrom:
            secretKeyRef:
              key: access_token
              name: matrix-neodatefix-bot-account
        image: registry.opencode.de/bmi/opendesk/components/supplier/nordeck/images-mirror/matrix-meetings-bot:2.8.0@sha256:db1d99c13a9facfd08a7da1d0a9c7c05715bad47110e93649ad6b389e462b42c
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: http
          timeoutSeconds: 5
        name: widget
        ports:
        - containerPort: 3000
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 10
          initialDelaySeconds: 15
          periodSeconds: 15
          successThreshold: 1
          tcpSocket:
            port: http
          timeoutSeconds: 5
        resources:
          limits:
            cpu: 99
            memory: 512Mi
          requests:
            cpu: 0.1
            memory: 128Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 101
          runAsNonRoot: true
          runAsUser: 101
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /app/storage
          name: data
        - mountPath: /app/conf
          name: config
        - mountPath: /app/widget-images
          name: widget-images
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: Always
      serviceAccountName: matrix-neodatefix-bot
      volumes:
      - name: data
        persistentVolumeClaim:
          claimName: matrix-neodatefix-bot
      - configMap:
          name: matrix-neodatefix-bot-config
        name: config
      - configMap:
          name: matrix-neodatefix-bot-widget-images
        name: widget-images
      - emptyDir:
          medium: Memory
          sizeLimit: 50Mi
        name: tmp
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: openproject
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: openproject
    app.kubernetes.io/version: 14.6.3
    helm.sh/chart: openproject-8.3.2
    openproject/process: web
  name: openproject-web
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: openproject
      app.kubernetes.io/name: openproject
      openproject/process: web
  strategy:
    type: Recreate
  template:
    metadata:
      annotations:
        checksum/env-core: a8877779912b187fb5df053619e9f344ccbbe877151ccb639d1196245a3f69c7
        checksum/env-environment: f5f0eecb12290c0ccb91df7977c8e046fde1f3ca9f367844564d9a0bb76ec544
        checksum/env-memcached: 7af45fe74ce427dcb46ec5adfb43183eea66c4e0fa5f54edf3c2204288982fbf
        checksum/env-oidc: 0e3fc025ee4cdb0ad2fc6314a53122fb2689892d2f1783a20469e3fefa34b4cc
        checksum/env-s3: 44711181346f6c158b87d3d46c096fda93cb4d08e7309345ac234daa0644dff9
      labels:
        app.kubernetes.io/instance: openproject
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: openproject
        app.kubernetes.io/version: 14.6.3
        helm.sh/chart: openproject-8.3.2
        openproject/process: web
    spec:
      containers:
      - command:
        - bash
        - /app/docker/prod/web
        env:
        - name: OPENPROJECT_DB_PASSWORD
          value: 2f8fea4e3716ce8fa44ae96bd699ea77347519f9
        envFrom:
        - secretRef:
            name: openproject-core
        - secretRef:
            name: openproject-oidc
        - secretRef:
            name: openproject-s3
        - secretRef:
            name: openproject-memcached
        - secretRef:
            name: openproject-environment
        image: registry.opencode.de/bmi/opendesk/components/supplier/openproject/images-mirror/open_desk:14.6.3@sha256:8d04eb793503e1a7e230b56c53c1a656c106a403aa823afa94a6219779bb1829
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 30
          httpGet:
            httpHeaders:
            - name: Host
              value: localhost
            path: /health_checks/default
            port: 8080
          initialDelaySeconds: 300
          periodSeconds: 30
          successThreshold: 1
          timeoutSeconds: 3
        name: openproject
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 30
          httpGet:
            httpHeaders:
            - name: Host
              value: localhost
            path: /health_checks/default
            port: 8080
          initialDelaySeconds: 150
          periodSeconds: 15
          successThreshold: 1
          timeoutSeconds: 3
        resources:
          limits:
            cpu: 99
            memory: 2Gi
          requests:
            cpu: 0.1
            memory: 768Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /app/tmp
          name: app-tmp
      initContainers:
      - command:
        - bash
        - /app/docker/prod/wait-for-db
        env:
        - name: OPENPROJECT_DB_PASSWORD
          value: 2f8fea4e3716ce8fa44ae96bd699ea77347519f9
        envFrom:
        - secretRef:
            name: openproject-core
        - secretRef:
            name: openproject-oidc
        - secretRef:
            name: openproject-s3
        - secretRef:
            name: openproject-memcached
        - secretRef:
            name: openproject-environment
        image: registry.opencode.de/bmi/opendesk/components/supplier/openproject/images-mirror/open_desk:14.6.3@sha256:8d04eb793503e1a7e230b56c53c1a656c106a403aa823afa94a6219779bb1829
        imagePullPolicy: IfNotPresent
        name: wait-for-db
        resources:
          limits:
            cpu: 99
            memory: 768Mi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
      securityContext:
        fsGroup: 1000
      serviceAccountName: openproject
      volumes:
      - ephemeral:
          volumeClaimTemplate:
            metadata:
              creationTimestamp: null
            spec:
              accessModes:
              - ReadWriteOnce
              resources:
                requests:
                  storage: 5Gi
        name: tmp
      - ephemeral:
          volumeClaimTemplate:
            metadata:
              creationTimestamp: null
            spec:
              accessModes:
              - ReadWriteOnce
              resources:
                requests:
                  storage: 5Gi
        name: app-tmp
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: openproject
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: openproject
    app.kubernetes.io/version: 14.6.3
    helm.sh/chart: openproject-8.3.2
    openproject/process: worker-default
  name: openproject-worker-default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: openproject
      app.kubernetes.io/name: openproject
      openproject/process: worker-default
  strategy:
    type: Recreate
  template:
    metadata:
      annotations:
        checksum/env-core: a8877779912b187fb5df053619e9f344ccbbe877151ccb639d1196245a3f69c7
        checksum/env-environment: f5f0eecb12290c0ccb91df7977c8e046fde1f3ca9f367844564d9a0bb76ec544
        checksum/env-memcached: 7af45fe74ce427dcb46ec5adfb43183eea66c4e0fa5f54edf3c2204288982fbf
        checksum/env-oidc: 0e3fc025ee4cdb0ad2fc6314a53122fb2689892d2f1783a20469e3fefa34b4cc
        checksum/env-s3: 44711181346f6c158b87d3d46c096fda93cb4d08e7309345ac234daa0644dff9
      labels:
        app.kubernetes.io/instance: openproject
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: openproject
        app.kubernetes.io/version: 14.6.3
        helm.sh/chart: openproject-8.3.2
        openproject/process: worker-default
    spec:
      containers:
      - command:
        - bash
        - /app/docker/prod/worker
        env:
        - name: OPENPROJECT_DB_PASSWORD
          value: 2f8fea4e3716ce8fa44ae96bd699ea77347519f9
        - name: OPENPROJECT_GOOD_JOB_QUEUES
          value: ''
        envFrom:
        - secretRef:
            name: openproject-core
        - secretRef:
            name: openproject-oidc
        - secretRef:
            name: openproject-s3
        - secretRef:
            name: openproject-memcached
        - secretRef:
            name: openproject-environment
        image: registry.opencode.de/bmi/opendesk/components/supplier/openproject/images-mirror/open_desk:14.6.3@sha256:8d04eb793503e1a7e230b56c53c1a656c106a403aa823afa94a6219779bb1829
        imagePullPolicy: IfNotPresent
        name: openproject
        resources:
          limits:
            cpu: 99
            memory: 4Gi
          requests:
            cpu: 0.25
            memory: 512Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /app/tmp
          name: app-tmp
      initContainers:
      - command:
        - bash
        - /app/docker/prod/wait-for-db
        env:
        - name: OPENPROJECT_DB_PASSWORD
          value: 2f8fea4e3716ce8fa44ae96bd699ea77347519f9
        envFrom:
        - secretRef:
            name: openproject-core
        - secretRef:
            name: openproject-oidc
        - secretRef:
            name: openproject-s3
        - secretRef:
            name: openproject-memcached
        - secretRef:
            name: openproject-environment
        image: registry.opencode.de/bmi/opendesk/components/supplier/openproject/images-mirror/open_desk:14.6.3@sha256:8d04eb793503e1a7e230b56c53c1a656c106a403aa823afa94a6219779bb1829
        imagePullPolicy: IfNotPresent
        name: wait-for-db
        resources:
          limits:
            cpu: 99
            memory: 768Mi
          requests:
            cpu: 0.1
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seLinuxOptions: null
          seccompProfile:
            type: RuntimeDefault
      securityContext:
        fsGroup: 1000
      serviceAccountName: openproject
      volumes:
      - ephemeral:
          volumeClaimTemplate:
            metadata:
              creationTimestamp: null
            spec:
              accessModes:
              - ReadWriteOnce
              resources:
                requests:
                  storage: 5Gi
        name: tmp
      - ephemeral:
          volumeClaimTemplate:
            metadata:
              creationTimestamp: null
            spec:
              accessModes:
              - ReadWriteOnce
              resources:
                requests:
                  storage: 5Gi
        name: app-tmp
